I"»œ<p><a href="http://www.onevcat.com/wp-content/uploads/2012/08/QQ20120828-3.png"><img src="http://www.onevcat.com/wp-content/uploads/2012/08/QQ20120828-3.png" alt="" title="uicollectionview-struct" /></a></p>

<p>è¿™æ˜¯åšä¸»çš„WWDC2012ç¬”è®°ç³»åˆ—ä¸­çš„ä¸€ç¯‡ï¼Œå®Œæ•´çš„ç¬”è®°åˆ—è¡¨å¯ä»¥å‚çœ‹<a href="http://onevcat.com/2012/06/%E5%BC%80%E5%8F%91%E8%80%85%E6%89%80%E9%9C%80%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84ios6-sdk%E6%96%B0%E7%89%B9%E6%80%A7/">è¿™é‡Œ</a>ã€‚å¦‚æœæ‚¨æ˜¯é¦–æ¬¡æ¥åˆ°æœ¬ç«™ï¼Œä¹Ÿè®¸æ‚¨ä¼šæœ‰å…´è¶£é€šè¿‡<a href="http://onevcat.com/atom.xml">RSS</a>ï¼Œæˆ–è€…é€šè¿‡é¡µé¢å·¦ä¾§çš„é‚®ä»¶è®¢é˜…çš„æ–¹å¼è®¢é˜…æœ¬ç«™ã€‚</p>

<p>åœ¨ä¸Šä¸€ç¯‡<a href="http://www.onevcat.com/2012/06/introducing-collection-views/">UICollectionViewçš„å…¥é—¨ä»‹ç»</a>ä¸­ï¼Œå¤§æ¦‚åœ°å¯¹iOS6æ–°åŠ å…¥çš„å¼ºå¤§çš„UICollectionViewè¿›è¡Œäº†ä¸€äº›è¯´æ˜ã€‚åœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œå°†ç»“åˆWWDC2012 Session219ï¼šAdvanced Collection Viewçš„å†…å®¹ï¼Œå¯¹Collection Viewè¿›è¡Œä¸€ä¸ªæ·±å…¥çš„ä½¿ç”¨æ¢è®¨ï¼Œå¹¶ç»™å‡ºä¸€ä¸ªè‡ªå®šä¹‰çš„Demoã€‚</p>

<h2 id="uicollectionviewçš„ç»“æ„å›é¡¾">UICollectionViewçš„ç»“æ„å›é¡¾</h2>

<p>é¦–å…ˆå›é¡¾ä¸€ä¸‹Collection Viewçš„æ„æˆï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°çš„æœ‰ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p>

<ul>
  <li>Cells</li>
  <li>Supplementary Views è¿½åŠ è§†å›¾ ï¼ˆç±»ä¼¼Headeræˆ–è€…Footerï¼‰</li>
  <li>Decoration Views è£…é¥°è§†å›¾ ï¼ˆç”¨ä½œèƒŒæ™¯å±•ç¤ºï¼‰</li>
</ul>

<p>è€Œåœ¨è¡¨é¢ä¸‹ï¼Œç”±ä¸¤ä¸ªæ–¹é¢å¯¹UICollectionViewè¿›è¡Œæ”¯æŒã€‚å…¶ä¸­ä¹‹ä¸€å’ŒtableViewä¸€æ ·ï¼Œå³æä¾›æ•°æ®çš„UICollectionViewDataSourceä»¥åŠå¤„ç†ç”¨æˆ·äº¤äº’çš„UICollectionViewDelegateã€‚å¦ä¸€æ–¹é¢ï¼Œå¯¹äºcellçš„æ ·å¼å’Œç»„ç»‡æ–¹å¼ï¼Œç”±äºcollectionViewæ¯”tableViewè¦å¤æ‚å¾—å¤šï¼Œå› æ­¤æ²¡æœ‰æŒ‰ç…§ç±»ä¼¼äºtableViewçš„styleçš„æ–¹å¼æ¥å®šä¹‰ï¼Œè€Œæ˜¯ä¸“é—¨ä½¿ç”¨äº†ä¸€ä¸ªç±»æ¥å¯¹collectionViewçš„å¸ƒå±€å’Œè¡Œä¸ºè¿›è¡Œæè¿°ï¼Œè¿™å°±æ˜¯UICollectionViewLayoutã€‚</p>

<p>è¿™æ¬¡çš„ç¬”è®°å°†æŠŠé‡ç‚¹æ”¾åœ¨UICollectionViewLayoutä¸Šï¼Œå› ä¸ºè¿™ä¸ä»…æ˜¯collectionViewå’ŒtableViewçš„æœ€é‡è¦æ±‚çš„åŒºåˆ«ï¼Œä¹Ÿæ˜¯æ•´ä¸ªUICollectionViewçš„ç²¾é«“æ‰€åœ¨ã€‚</p>

<p>å¦‚æœå¯¹UICollectionViewçš„åŸºæœ¬æ„æˆè¦ç´ å’Œä½¿ç”¨æ–¹æ³•è¿˜ä¸æ¸…æ¥šçš„è¯ï¼Œå¯ä»¥ç§»æ­¥åˆ°æˆ‘ä¹‹å‰çš„ä¸€ç¯‡ç¬”è®°ï¼š<a href="http://www.onevcat.com/2012/06/introducing-collection-views/">Sessionç¬”è®°â€”â€”205 Introducing Collection Views</a>ä¸­è¿›è¡Œä¸€äº›äº†è§£ã€‚</p>

<hr />

<h2 id="uicollectionviewlayoutattributes">UICollectionViewLayoutAttributes</h2>

<p>UICollectionViewLayoutAttributesæ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„ç±»ï¼Œå…ˆæ¥çœ‹çœ‹propertyåˆ—è¡¨ï¼š</p>

<ul>
  <li>@property (nonatomic) CGRect frame</li>
  <li>@property (nonatomic) CGPoint center</li>
  <li>@property (nonatomic) CGSize size</li>
  <li>@property (nonatomic) CATransform3D transform3D</li>
  <li>@property (nonatomic) CGFloat alpha</li>
  <li>@property (nonatomic) NSInteger zIndex</li>
  <li>@property (nonatomic, getter=isHidden) BOOL hidden</li>
</ul>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒUICollectionViewLayoutAttributesçš„å®ä¾‹ä¸­åŒ…å«äº†è¯¸å¦‚è¾¹æ¡†ï¼Œä¸­å¿ƒç‚¹ï¼Œå¤§å°ï¼Œå½¢çŠ¶ï¼Œé€æ˜åº¦ï¼Œå±‚æ¬¡å…³ç³»å’Œæ˜¯å¦éšè—ç­‰ä¿¡æ¯ã€‚å’ŒDataSourceçš„è¡Œä¸ºååˆ†ç±»ä¼¼ï¼Œå½“UICollectionViewåœ¨è·å–å¸ƒå±€æ—¶å°†é’ˆå¯¹æ¯ä¸€ä¸ªindexPathçš„éƒ¨ä»¶ï¼ˆåŒ…æ‹¬cellï¼Œè¿½åŠ è§†å›¾å’Œè£…é¥°è§†å›¾ï¼‰ï¼Œå‘å…¶ä¸Šçš„UICollectionViewLayoutå®ä¾‹è¯¢é—®è¯¥éƒ¨ä»¶çš„å¸ƒå±€ä¿¡æ¯ï¼ˆåœ¨è¿™ä¸ªå±‚é¢ä¸Šè¯´çš„è¯ï¼Œå®ç°ä¸€ä¸ªUICollectionViewLayoutçš„æ—¶å€™ï¼Œå…¶å®å¾ˆåƒæ˜¯zapä¸€ä¸ªdelegateï¼Œä¹‹åçš„ä¾‹å­ä¸­ä¼šå¾ˆæ˜æ˜¾åœ°çœ‹å‡ºï¼‰ï¼Œè¿™ä¸ªå¸ƒå±€ä¿¡æ¯ï¼Œå°±ä»¥UICollectionViewLayoutAttributesçš„å®ä¾‹çš„æ–¹å¼ç»™å‡ºã€‚</p>

<hr />

<h2 id="è‡ªå®šä¹‰çš„uicollectionviewlayout">è‡ªå®šä¹‰çš„UICollectionViewLayout</h2>

<p>UICollectionViewLayoutçš„åŠŸèƒ½ä¸ºå‘UICollectionViewæä¾›å¸ƒå±€ä¿¡æ¯ï¼Œä¸ä»…åŒ…æ‹¬cellçš„å¸ƒå±€ä¿¡æ¯ï¼Œä¹ŸåŒ…æ‹¬è¿½åŠ è§†å›¾å’Œè£…é¥°è§†å›¾çš„å¸ƒå±€ä¿¡æ¯ã€‚å®ç°ä¸€ä¸ªè‡ªå®šä¹‰layoutçš„å¸¸è§„åšæ³•æ˜¯ç»§æ‰¿UICollectionViewLayoutç±»ï¼Œç„¶åé‡è½½ä¸‹åˆ—æ–¹æ³•ï¼š</p>

<ul>
  <li>
    <p>-(CGSize)collectionViewContentSize</p>

    <ul>
      <li>è¿”å›collectionViewçš„å†…å®¹çš„å°ºå¯¸</li>
    </ul>
  </li>
  <li>
    <p>-(NSArray *)layoutAttributesForElementsInRect:(CGRect)rect</p>

    <ul>
      <li>è¿”å›rectä¸­çš„æ‰€æœ‰çš„å…ƒç´ çš„å¸ƒå±€å±æ€§</li>
      <li>è¿”å›çš„æ˜¯åŒ…å«UICollectionViewLayoutAttributesçš„NSArray</li>
      <li>
        <p>UICollectionViewLayoutAttributeså¯ä»¥æ˜¯cellï¼Œè¿½åŠ è§†å›¾æˆ–è£…é¥°è§†å›¾çš„ä¿¡æ¯ï¼Œé€šè¿‡ä¸åŒçš„UICollectionViewLayoutAttributesåˆå§‹åŒ–æ–¹æ³•å¯ä»¥å¾—åˆ°ä¸åŒç±»å‹çš„UICollectionViewLayoutAttributesï¼š</p>

        <ul>
          <li>layoutAttributesForCellWithIndexPath:</li>
          <li>layoutAttributesForSupplementaryViewOfKind:withIndexPath:</li>
          <li>layoutAttributesForDecorationViewOfKind:withIndexPath:</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p>-(UICollectionViewLayoutAttributes _)layoutAttributesForItemAtIndexPath:(NSIndexPath _)indexPath</p>

    <ul>
      <li>è¿”å›å¯¹åº”äºindexPathçš„ä½ç½®çš„cellçš„å¸ƒå±€å±æ€§</li>
    </ul>
  </li>
  <li>
    <p>-(UICollectionViewLayoutAttributes _)layoutAttributesForSupplementaryViewOfKind:(NSString _)kind atIndexPath:(NSIndexPath *)indexPath</p>

    <ul>
      <li>è¿”å›å¯¹åº”äºindexPathçš„ä½ç½®çš„è¿½åŠ è§†å›¾çš„å¸ƒå±€å±æ€§ï¼Œå¦‚æœæ²¡æœ‰è¿½åŠ è§†å›¾å¯ä¸é‡è½½</li>
    </ul>
  </li>
  <li>
    <p>-(UICollectionViewLayoutAttributes * )layoutAttributesForDecorationViewOfKind:(NSString_)decorationViewKind atIndexPath:(NSIndexPath _)indexPath</p>

    <ul>
      <li>è¿”å›å¯¹åº”äºindexPathçš„ä½ç½®çš„è£…é¥°è§†å›¾çš„å¸ƒå±€å±æ€§ï¼Œå¦‚æœæ²¡æœ‰è£…é¥°è§†å›¾å¯ä¸é‡è½½</li>
    </ul>
  </li>
  <li>
    <p>-(BOOL)shouldInvalidateLayoutForBoundsChange:(CGRect)newBounds</p>

    <ul>
      <li>å½“è¾¹ç•Œå‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ˜¯å¦åº”è¯¥åˆ·æ–°å¸ƒå±€ã€‚å¦‚æœYESåˆ™åœ¨è¾¹ç•Œå˜åŒ–ï¼ˆä¸€èˆ¬æ˜¯scrollåˆ°å…¶ä»–åœ°æ–¹ï¼‰æ—¶ï¼Œå°†é‡æ–°è®¡ç®—éœ€è¦çš„å¸ƒå±€ä¿¡æ¯ã€‚</li>
    </ul>
  </li>
</ul>

<p>å¦å¤–éœ€è¦äº†è§£çš„æ˜¯ï¼Œåœ¨åˆå§‹åŒ–ä¸€ä¸ªUICollectionViewLayoutå®ä¾‹åï¼Œä¼šæœ‰ä¸€ç³»åˆ—å‡†å¤‡æ–¹æ³•è¢«è‡ªåŠ¨è°ƒç”¨ï¼Œä»¥ä¿è¯layoutå®ä¾‹çš„æ­£ç¡®ã€‚</p>

<p>é¦–å…ˆï¼Œ-(void)prepareLayoutå°†è¢«è°ƒç”¨ï¼Œé»˜è®¤ä¸‹è¯¥æ–¹æ³•ä»€ä¹ˆæ²¡åšï¼Œä½†æ˜¯åœ¨è‡ªå·±çš„å­ç±»å®ç°ä¸­ï¼Œä¸€èˆ¬åœ¨è¯¥æ–¹æ³•ä¸­è®¾å®šä¸€äº›å¿…è¦çš„layoutçš„ç»“æ„å’Œåˆå§‹éœ€è¦çš„å‚æ•°ç­‰ã€‚</p>

<p>ä¹‹åï¼Œ-(CGSize) collectionViewContentSizeå°†è¢«è°ƒç”¨ï¼Œä»¥ç¡®å®šcollectionåº”è¯¥å æ®çš„å°ºå¯¸ã€‚æ³¨æ„è¿™é‡Œçš„å°ºå¯¸ä¸æ˜¯æŒ‡å¯è§†éƒ¨åˆ†çš„å°ºå¯¸ï¼Œè€Œåº”è¯¥æ˜¯æ‰€æœ‰å†…å®¹æ‰€å çš„å°ºå¯¸ã€‚collectionViewçš„æœ¬è´¨æ˜¯ä¸€ä¸ªscrollViewï¼Œå› æ­¤éœ€è¦è¿™ä¸ªå°ºå¯¸æ¥é…ç½®æ»šåŠ¨è¡Œä¸ºã€‚</p>

<p>æ¥ä¸‹æ¥-(NSArray *)layoutAttributesForElementsInRect:(CGRect)rectè¢«è°ƒç”¨ï¼Œè¿™ä¸ªæ²¡ä»€ä¹ˆå€¼å¾—å¤šè¯´çš„ã€‚åˆå§‹çš„layoutçš„å¤–è§‚å°†ç”±è¯¥æ–¹æ³•è¿”å›çš„UICollectionViewLayoutAttributesæ¥å†³å®šã€‚</p>

<p>å¦å¤–ï¼Œåœ¨éœ€è¦æ›´æ–°layoutæ—¶ï¼Œéœ€è¦ç»™å½“å‰layoutå‘é€ -invalidateLayoutï¼Œè¯¥æ¶ˆæ¯ä¼šç«‹å³è¿”å›ï¼Œå¹¶ä¸”é¢„çº¦åœ¨ä¸‹ä¸€ä¸ªloopçš„æ—¶å€™åˆ·æ–°å½“å‰layoutï¼Œè¿™ä¸€ç‚¹å’ŒUIViewçš„setNeedsLayoutæ–¹æ³•ååˆ†ç±»ä¼¼ã€‚åœ¨-invalidateLayoutåçš„ä¸‹ä¸€ä¸ªcollectionViewçš„åˆ·æ–°loopä¸­ï¼Œåˆä¼šä»prepareLayoutå¼€å§‹ï¼Œä¾æ¬¡å†è°ƒç”¨-collectionViewContentSizeå’Œ-layoutAttributesForElementsInRectæ¥ç”Ÿæˆæ›´æ–°åçš„å¸ƒå±€ã€‚</p>

<hr />

<h2 id="demo">Demo</h2>

<p>è¯´äº†é‚£ä¹ˆå¤šï¼Œå…¶å®è¿˜æ˜¯Demoæœ€èƒ½è§£å†³é—®é¢˜ã€‚Appleå®˜æ–¹ç»™äº†ä¸€ä¸ªflow layoutå’Œä¸€ä¸ªcircle layoutçš„ä¾‹å­ï¼Œéƒ½å¾ˆç»å…¸ï¼Œéœ€è¦çš„åŒå­¦å¯ä»¥ä»<a href="http://www.onevcat.com/wp-content/uploads/2012/08/advanced-collection-view-demo.zip">è¿™é‡Œä¸‹è½½</a>ã€‚</p>

<h3 id="linelayoutå¯¹äºä¸ªåˆ«uicollectionviewlayoutattributesçš„è°ƒæ•´">LineLayoutâ€”â€”å¯¹äºä¸ªåˆ«UICollectionViewLayoutAttributesçš„è°ƒæ•´</h3>

<p>å…ˆçœ‹LineLayoutï¼Œå®ƒç»§æ‰¿äº†UICollectionViewFlowLayoutè¿™ä¸ªAppleæä¾›çš„åŸºæœ¬çš„å¸ƒå±€ã€‚å®ƒä¸»è¦å®ç°äº†å•è¡Œå¸ƒå±€ï¼Œè‡ªåŠ¨å¯¹é½åˆ°ç½‘æ ¼ä»¥åŠå½“å‰ç½‘æ ¼cellæ”¾å¤§ä¸‰ä¸ªç‰¹æ€§ã€‚å¦‚å›¾ï¼š</p>

<p><a href="http://www.onevcat.com/wp-content/uploads/2012/08/QQ20120828-1-e1346145550225.png"><img src="http://www.onevcat.com/wp-content/uploads/2012/08/QQ20120828-1-e1346145550225.png" alt="" title="collection-view-line-layout" /></a></p>

<p>å…ˆçœ‹LineLayoutçš„initæ–¹æ³•ï¼š</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">-</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">init</span>
<span class="p">{</span>
    <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">self</span><span class="p">.</span><span class="n">itemSize</span> <span class="o">=</span> <span class="n">CGSizeMake</span><span class="p">(</span><span class="n">ITEM_SIZE</span><span class="p">,</span> <span class="n">ITEM_SIZE</span><span class="p">);</span>
        <span class="n">self</span><span class="p">.</span><span class="n">scrollDirection</span> <span class="o">=</span> <span class="n">UICollectionViewScrollDirectionHorizontal</span><span class="p">;</span>
        <span class="n">self</span><span class="p">.</span><span class="n">sectionInset</span> <span class="o">=</span> <span class="n">UIEdgeInsetsMake</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
        <span class="n">self</span><span class="p">.</span><span class="n">minimumLineSpacing</span> <span class="o">=</span> <span class="mi">50</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>self.sectionInset = UIEdgeInsetsMake(200, 0.0, 200, 0.0); ç¡®å®šäº†ç¼©è¿›ï¼Œæ­¤å¤„ä¸ºä¸Šæ–¹å’Œä¸‹æ–¹å„ç¼©è¿›200ä¸ªpointã€‚ç”±äºcellçš„sizeå·²ç»å®šä¹‰äº†ä¸º200x200ï¼Œå› æ­¤å±å¹•ä¸Šåœ¨ç¼©è¿›åå°±åªæœ‰ä¸€æ’itemçš„ç©ºé—´äº†ã€‚</p>

<p>self.minimumLineSpacing = 50.0; è¿™ä¸ªå®šä¹‰äº†æ¯ä¸ªitemåœ¨æ°´å¹³æ–¹å‘ä¸Šçš„æœ€å°é—´è·ã€‚</p>

<p>UICollectionViewFlowLayoutæ˜¯Appleä¸ºæˆ‘ä»¬å‡†å¤‡çš„å¼€è¢‹å³é£Ÿçš„ç°æˆå¸ƒå±€ï¼Œå› æ­¤ä¹‹å‰æåˆ°çš„å‡ ä¸ªå¿…é¡»é‡è½½çš„æ–¹æ³•ä¸­éœ€è¦æˆ‘ä»¬æ“å¿ƒçš„å¾ˆå°‘ï¼Œå³ä½¿å®Œå…¨ä¸é‡è½½å®ƒä»¬ï¼Œç°åœ¨ä¹Ÿå¯ä»¥å¾—åˆ°ä¸€ä¸ªä¸é”™çš„çº¿çŠ¶ä¸€è¡Œçš„gridviewäº†ã€‚è€Œæˆ‘ä»¬çš„LineLayouté€šè¿‡é‡è½½çˆ¶ç±»æ–¹æ³•åï¼Œå¯ä»¥å®ç°ä¸€äº›æ–°ç‰¹æ€§ï¼Œæ¯”å¦‚è¿™é‡Œçš„åŠ¨å¯¹é½åˆ°ç½‘æ ¼ä»¥åŠå½“å‰ç½‘æ ¼cellæ”¾å¤§ã€‚</p>

<p>è‡ªåŠ¨å¯¹é½åˆ°ç½‘æ ¼</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="n">CGPoint</span><span class="p">)</span><span class="nf">targetContentOffsetForProposedContentOffset</span><span class="p">:</span> <span class="p">(</span><span class="n">CGPoint</span><span class="p">)</span><span class="nv">proposedContentOffset</span> <span class="nf">withScrollingVelocity</span><span class="p">:(</span><span class="n">CGPoint</span><span class="p">)</span><span class="nv">velocity</span>
<span class="p">{</span>
    <span class="c1">//proposedContentOffsetæ˜¯æ²¡æœ‰å¯¹é½åˆ°ç½‘æ ¼æ—¶æœ¬æ¥åº”è¯¥åœä¸‹çš„ä½ç½®</span>
    <span class="n">CGFloat</span> <span class="n">offsetAdjustment</span> <span class="o">=</span> <span class="n">MAXFLOAT</span><span class="p">;</span>
    <span class="n">CGFloat</span> <span class="n">horizontalCenter</span> <span class="o">=</span> <span class="n">proposedContentOffset</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">CGRectGetWidth</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">collectionView</span><span class="p">.</span><span class="n">bounds</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">CGRect</span> <span class="n">targetRect</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="n">proposedContentOffset</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">collectionView</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">collectionView</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">);</span>
    <span class="n">NSArray</span><span class="o">*</span> <span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">layoutAttributesForElementsInRect</span><span class="p">:</span><span class="n">targetRect</span><span class="p">];</span>

    <span class="c1">//å¯¹å½“å‰å±å¹•ä¸­çš„UICollectionViewLayoutAttributesé€ä¸ªä¸å±å¹•ä¸­å¿ƒè¿›è¡Œæ¯”è¾ƒï¼Œæ‰¾å‡ºæœ€æ¥è¿‘ä¸­å¿ƒçš„ä¸€ä¸ª</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">UICollectionViewLayoutAttributes</span><span class="o">*</span> <span class="n">layoutAttributes</span> <span class="k">in</span> <span class="n">array</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">CGFloat</span> <span class="n">itemHorizontalCenter</span> <span class="o">=</span> <span class="n">layoutAttributes</span><span class="p">.</span><span class="n">center</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ABS</span><span class="p">(</span><span class="n">itemHorizontalCenter</span> <span class="o">-</span> <span class="n">horizontalCenter</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">ABS</span><span class="p">(</span><span class="n">offsetAdjustment</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">offsetAdjustment</span> <span class="o">=</span> <span class="n">itemHorizontalCenter</span> <span class="o">-</span> <span class="n">horizontalCenter</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">CGPointMake</span><span class="p">(</span><span class="n">proposedContentOffset</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">offsetAdjustment</span><span class="p">,</span> <span class="n">proposedContentOffset</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å½“å‰itemæ”¾å¤§</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">-</span><span class="p">(</span><span class="n">NSArray</span> <span class="o">*</span><span class="p">)</span><span class="nf">layoutAttributesForElementsInRect</span><span class="p">:(</span><span class="n">CGRect</span><span class="p">)</span><span class="nv">rect</span>
<span class="p">{</span>
    <span class="n">NSArray</span> <span class="o">*</span><span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">layoutAttributesForElementsInRect</span><span class="p">:</span><span class="n">rect</span><span class="p">];</span>
    <span class="n">CGRect</span> <span class="n">visibleRect</span><span class="p">;</span>
    <span class="n">visibleRect</span><span class="p">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">collectionView</span><span class="p">.</span><span class="n">contentOffset</span><span class="p">;</span>
    <span class="n">visibleRect</span><span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">collectionView</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">size</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">UICollectionViewLayoutAttributes</span><span class="o">*</span> <span class="n">attributes</span> <span class="k">in</span> <span class="n">array</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">CGRectIntersectsRect</span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">frame</span><span class="p">,</span> <span class="n">rect</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">CGFloat</span> <span class="n">distance</span> <span class="o">=</span> <span class="n">CGRectGetMidX</span><span class="p">(</span><span class="n">visibleRect</span><span class="p">)</span> <span class="o">-</span> <span class="n">attributes</span><span class="p">.</span><span class="n">center</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
            <span class="n">CGFloat</span> <span class="n">normalizedDistance</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">/</span> <span class="n">ACTIVE_DISTANCE</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ABS</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">ACTIVE_DISTANCE</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">CGFloat</span> <span class="n">zoom</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">ZOOM_FACTOR</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ABS</span><span class="p">(</span><span class="n">normalizedDistance</span><span class="p">));</span>
                <span class="n">attributes</span><span class="p">.</span><span class="n">transform3D</span> <span class="o">=</span> <span class="n">CATransform3DMakeScale</span><span class="p">(</span><span class="n">zoom</span><span class="p">,</span> <span class="n">zoom</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
                <span class="n">attributes</span><span class="p">.</span><span class="n">zIndex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">array</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å¯¹äºä¸ªåˆ«UICollectionViewLayoutAttributesè¿›è¡Œè°ƒæ•´ï¼Œä»¥è¾¾åˆ°æ»¡è¶³è®¾è®¡éœ€æ±‚æ˜¯UICollectionViewä½¿ç”¨ä¸­çš„ä¸€ç§æ€è·¯ã€‚åœ¨æ ¹æ®ä½ç½®æä¾›ä¸åŒlayoutå±æ€§çš„æ—¶å€™ï¼Œéœ€è¦è®°å¾—è®©-shouldInvalidateLayoutForBoundsChange:è¿”å›YESï¼Œè¿™æ ·å½“è¾¹ç•Œæ”¹å˜çš„æ—¶å€™ï¼Œ-invalidateLayoutä¼šè‡ªåŠ¨è¢«å‘é€ï¼Œæ‰èƒ½è®©layoutå¾—åˆ°åˆ·æ–°ã€‚</p>

<h3 id="circlelayoutå®Œå…¨è‡ªå®šä¹‰çš„layoutæ·»åŠ åˆ é™¤itemä»¥åŠæ‰‹åŠ¿è¯†åˆ«">CircleLayoutâ€”â€”å®Œå…¨è‡ªå®šä¹‰çš„Layoutï¼Œæ·»åŠ åˆ é™¤itemï¼Œä»¥åŠæ‰‹åŠ¿è¯†åˆ«</h3>

<p>CircleLayoutçš„ä¾‹å­ç¨å¾®å¤æ‚ä¸€äº›ï¼Œcellåˆ†å¸ƒåœ¨åœ†å‘¨ä¸Šï¼Œç‚¹å‡»cellçš„è¯ä¼šå°†å…¶ä»collectionViewä¸­ç§»å‡ºï¼Œç‚¹å‡»ç©ºç™½å¤„ä¼šåŠ å…¥ä¸€ä¸ªcellï¼ŒåŠ å…¥å’Œç§»å‡ºéƒ½æœ‰åŠ¨ç”»æ•ˆæœã€‚</p>

<p>è¿™æ”¾åœ¨ä»¥å‰çš„è¯ä¼°è®¡å¤Ÿå†™ä¸€é˜µå­äº†ï¼Œè€Œå¾—ç›ŠäºUICollectionViewï¼ŒåŸºæœ¬åªéœ€è¦100æ¥è¡Œä»£ç å°±å¯ä»¥æå®šè¿™ä¸€åˆ‡ï¼Œéå¸¸cheapã€‚é€šè¿‡CircleLayoutçš„å®ç°ï¼Œå¯ä»¥å®Œæ•´åœ°çœ‹åˆ°è‡ªå®šä¹‰çš„layoutçš„ç¼–å†™æµç¨‹ï¼Œéå¸¸å…·æœ‰å­¦ä¹ å’Œå€Ÿé‰´çš„æ„ä¹‰ã€‚</p>

<p><img src="http://www.onevcat.com/wp-content/uploads/2012/06/QQ20120630-5.png" alt="CircleLayout" /></p>

<p>é¦–å…ˆï¼Œå¸ƒå±€å‡†å¤‡ä¸­å®šä¹‰äº†ä¸€äº›ä¹‹åè®¡ç®—æ‰€éœ€è¦ç”¨åˆ°çš„å‚æ•°ã€‚</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">prepareLayout</span>
<span class="p">{</span>   <span class="c1">//å’Œinitç›¸ä¼¼ï¼Œå¿…é¡»call superçš„prepareLayoutä»¥ä¿è¯åˆå§‹åŒ–æ­£ç¡®</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">prepareLayout</span><span class="p">];</span>

    <span class="n">CGSize</span> <span class="n">size</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">collectionView</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">;</span>
    <span class="n">_cellCount</span> <span class="o">=</span> <span class="p">[[</span><span class="n">self</span> <span class="nf">collectionView</span><span class="p">]</span> <span class="nf">numberOfItemsInSection</span><span class="p">:</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">_center</span> <span class="o">=</span> <span class="n">CGPointMake</span><span class="p">(</span><span class="n">size</span><span class="p">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="p">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">_radius</span> <span class="o">=</span> <span class="n">MIN</span><span class="p">(</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">.</span><span class="mi">5</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å…¶å®å¯¹äºä¸€ä¸ªsizeä¸å˜çš„collectionViewæ¥è¯´ï¼Œé™¤äº†_cellCountä¹‹å¤–çš„ä¸­å¿ƒå’ŒåŠå¾„çš„å®šä¹‰ä¹Ÿå¯ä»¥æ‰”åˆ°inité‡Œå»åšï¼Œä½†æ˜¯æ˜¾ç„¶åœ¨prepareLayouté‡Œåšçš„è¯å…·æœ‰æ›´å¤§çš„çµæ´»æ€§ã€‚å› ä¸ºæ¯æ¬¡é‡æ–°ç»™å‡ºlayoutæ—¶éƒ½ä¼šè°ƒç”¨prepareLayoutï¼Œè¿™æ ·åœ¨ä»¥åå¦‚æœæœ‰collectionViewå¤§å°å˜åŒ–çš„éœ€æ±‚æ—¶ä¹Ÿå¯ä»¥è‡ªåŠ¨é€‚åº”å˜åŒ–ã€‚</p>

<p>ç„¶åï¼ŒæŒ‰ç…§UICollectionViewLayoutå­ç±»çš„è¦æ±‚ï¼Œé‡è½½äº†æ‰€éœ€è¦çš„æ–¹æ³•ï¼š</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//æ•´ä¸ªcollectionViewçš„å†…å®¹å¤§å°å°±æ˜¯collectionViewçš„å¤§å°ï¼ˆæ²¡æœ‰æ»šåŠ¨ï¼‰</span>
<span class="k">-</span><span class="p">(</span><span class="n">CGSize</span><span class="p">)</span><span class="n">collectionViewContentSize</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">self</span> <span class="nf">collectionView</span><span class="p">].</span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//é€šè¿‡æ‰€åœ¨çš„indexPathç¡®å®šä½ç½®ã€‚</span>
<span class="k">-</span> <span class="p">(</span><span class="n">UICollectionViewLayoutAttributes</span> <span class="o">*</span><span class="p">)</span><span class="nf">layoutAttributesForItemAtIndexPath</span><span class="p">:(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">path</span>
<span class="p">{</span>
    <span class="n">UICollectionViewLayoutAttributes</span><span class="o">*</span> <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">UICollectionViewLayoutAttributes</span> <span class="nf">layoutAttributesForCellWithIndexPath</span><span class="p">:</span><span class="n">path</span><span class="p">];</span> <span class="c1">//ç”Ÿæˆç©ºç™½çš„attributeså¯¹è±¡ï¼Œå…¶ä¸­åªè®°å½•äº†ç±»å‹æ˜¯cellä»¥åŠå¯¹åº”çš„ä½ç½®æ˜¯indexPath</span>
    <span class="c1">//é…ç½®attributesåˆ°åœ†å‘¨ä¸Š</span>
    <span class="n">attributes</span><span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">CGSizeMake</span><span class="p">(</span><span class="n">ITEM_SIZE</span><span class="p">,</span> <span class="n">ITEM_SIZE</span><span class="p">);</span>
    <span class="n">attributes</span><span class="p">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">CGPointMake</span><span class="p">(</span><span class="n">_center</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">_radius</span> <span class="o">*</span> <span class="n">cosf</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">path</span><span class="p">.</span><span class="n">item</span> <span class="o">*</span> <span class="n">M_PI</span> <span class="o">/</span> <span class="n">_cellCount</span><span class="p">),</span> <span class="n">_center</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">_radius</span> <span class="o">*</span> <span class="n">sinf</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">path</span><span class="p">.</span><span class="n">item</span> <span class="o">*</span> <span class="n">M_PI</span> <span class="o">/</span> <span class="n">_cellCount</span><span class="p">));</span>
    <span class="k">return</span> <span class="n">attributes</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//ç”¨æ¥åœ¨ä¸€å¼€å§‹ç»™å‡ºä¸€å¥—UICollectionViewLayoutAttributes</span>
<span class="k">-</span><span class="p">(</span><span class="n">NSArray</span><span class="o">*</span><span class="p">)</span><span class="nf">layoutAttributesForElementsInRect</span><span class="p">:(</span><span class="n">CGRect</span><span class="p">)</span><span class="nv">rect</span>
<span class="p">{</span>
    <span class="n">NSMutableArray</span><span class="o">*</span> <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableArray</span> <span class="nf">array</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">NSInteger</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span> <span class="p">;</span> <span class="n">i</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">self</span><span class="p">.</span><span class="n">cellCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//è¿™é‡Œåˆ©ç”¨äº†-layoutAttributesForItemAtIndexPath:æ¥è·å–attributes</span>
        <span class="n">NSIndexPath</span><span class="o">*</span> <span class="n">indexPath</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSIndexPath</span> <span class="nf">indexPathForItem</span><span class="p">:</span><span class="n">i</span> <span class="nf">inSection</span><span class="p">:</span><span class="mi">0</span><span class="p">];</span>
        <span class="p">[</span><span class="n">attributes</span> <span class="nf">addObject</span><span class="p">:[</span><span class="n">self</span> <span class="nf">layoutAttributesForItemAtIndexPath</span><span class="p">:</span><span class="n">indexPath</span><span class="p">]];</span>
    <span class="p">}</span>    
    <span class="k">return</span> <span class="n">attributes</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ç°åœ¨å·²ç»å¾—åˆ°äº†ä¸€ä¸ªcircle layoutã€‚ä¸ºäº†å®ç°cellçš„æ·»åŠ å’Œåˆ é™¤ï¼Œéœ€è¦ä¸ºcollectionViewåŠ ä¸Šæ‰‹åŠ¿è¯†åˆ«ï¼Œè¿™ä¸ªå¾ˆç®€å•ï¼Œåœ¨ViewControllerä¸­ï¼š</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">UITapGestureRecognizer</span><span class="o">*</span> <span class="n">tapRecognizer</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UITapGestureRecognizer</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithTarget</span><span class="p">:</span><span class="n">self</span> <span class="nf">action</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">handleTapGesture</span><span class="o">:</span><span class="p">)];</span>
<span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">collectionView</span> <span class="nf">addGestureRecognizer</span><span class="p">:</span><span class="n">tapRecognizer</span><span class="p">];</span>
</code></pre></div></div>

<p>å¯¹åº”çš„å¤„ç†æ–¹æ³•handleTapGesture:ä¸º</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">handleTapGesture</span><span class="p">:(</span><span class="n">UITapGestureRecognizer</span> <span class="o">*</span><span class="p">)</span><span class="nv">sender</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sender</span><span class="p">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">UIGestureRecognizerStateEnded</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">CGPoint</span> <span class="n">initialPinchPoint</span> <span class="o">=</span> <span class="p">[</span><span class="n">sender</span> <span class="nf">locationInView</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">collectionView</span><span class="p">];</span>
        <span class="n">NSIndexPath</span><span class="o">*</span> <span class="n">tappedCellPath</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">collectionView</span> <span class="nf">indexPathForItemAtPoint</span><span class="p">:</span><span class="n">initialPinchPoint</span><span class="p">];</span> <span class="c1">//è·å–ç‚¹å‡»å¤„çš„cellçš„indexPath</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tappedCellPath</span><span class="o">!=</span><span class="nb">nil</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//ç‚¹å‡»å¤„æ²¡æœ‰cell</span>
            <span class="n">self</span><span class="p">.</span><span class="n">cellCount</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">cellCount</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">collectionView</span> <span class="nf">performBatchUpdates</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
                <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">collectionView</span> <span class="nf">deleteItemsAtIndexPaths</span><span class="p">:[</span><span class="n">NSArray</span> <span class="nf">arrayWithObject</span><span class="p">:</span><span class="n">tappedCellPath</span><span class="p">]];</span>
            <span class="p">}</span> <span class="nf">completion</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">self</span><span class="p">.</span><span class="n">cellCount</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">cellCount</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">collectionView</span> <span class="nf">performBatchUpdates</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
                <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">collectionView</span> <span class="nf">insertItemsAtIndexPaths</span><span class="p">:[</span><span class="n">NSArray</span> <span class="nf">arrayWithObject</span><span class="p">:[</span><span class="n">NSIndexPath</span> <span class="nf">indexPathForItem</span><span class="p">:</span><span class="mi">0</span> <span class="nf">inSection</span><span class="p">:</span><span class="mi">0</span><span class="p">]]];</span>
            <span class="p">}</span> <span class="nf">completion</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>performBatchUpdates:completion: å†æ¬¡å±•ç¤ºäº†blockçš„å¼ºå¤§çš„ä¸€é¢..è¿™ä¸ªæ–¹æ³•å¯ä»¥ç”¨æ¥å¯¹collectionViewä¸­çš„å…ƒç´ è¿›è¡Œæ‰¹é‡çš„æ’å…¥ï¼Œåˆ é™¤ï¼Œç§»åŠ¨ç­‰æ“ä½œï¼ŒåŒæ—¶å°†è§¦å‘collectionViewæ‰€å¯¹åº”çš„layoutçš„å¯¹åº”çš„åŠ¨ç”»ã€‚ç›¸åº”çš„åŠ¨ç”»ç”±layoutä¸­çš„ä¸‹åˆ—å››ä¸ªæ–¹æ³•æ¥å®šä¹‰ï¼š</p>

<ul>
  <li>initialLayoutAttributesForAppearingItemAtIndexPath:</li>
  <li>initialLayoutAttributesForAppearingDecorationElementOfKind:atIndexPath:</li>
  <li>finalLayoutAttributesForDisappearingItemAtIndexPath:</li>
  <li>finalLayoutAttributesForDisappearingDecorationElementOfKind:atIndexPath:</li>
</ul>

<blockquote>
  <p>æ›´æ­£ï¼šæ­£å¼ç‰ˆä¸­APIå‘ç”Ÿäº†å˜åŒ–ï¼ˆè€Œä¸”ä¸æ­¢ä¸€æ¬¡å˜åŒ–
initialLayoutAttributesForInsertedItemAtIndexPath:åœ¨æ­£å¼ç‰ˆä¸­å·²ç»è¢«åºŸé™¤ã€‚ç°åœ¨åœ¨insertæˆ–è€…deleteä¹‹å‰ï¼ŒprepareForCollectionViewUpdates:ä¼šè¢«è°ƒç”¨ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¥å®Œæˆæ·»åŠ /åˆ é™¤çš„å¸ƒå±€ã€‚å…³äºæ›´å¤šè¿™æ–¹é¢çš„å†…å®¹ä»¥åŠæ–°çš„ç¤ºä¾‹demoï¼Œå¯ä»¥å‚çœ‹<a href="http://markpospesel.wordpress.com/2012/10/25/fixing-circlelayout/">è¿™ç¯‡åšæ–‡</a>ï¼ˆéœ€è¦ç¿»å¢™ï¼‰ã€‚æ–°çš„ç¤ºä¾‹demoåœ¨Githubä¸Šä¹Ÿæœ‰ï¼Œ<a href="https://github.com/mpospese/CircleLayout">é“¾æ¥</a></p>
</blockquote>

<p>åœ¨CircleLayoutä¸­ï¼Œå®ç°äº†cellçš„åŠ¨ç”»ã€‚</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//æ’å…¥å‰ï¼Œcellåœ¨åœ†å¿ƒä½ç½®ï¼Œå…¨é€æ˜</span>
<span class="k">-</span> <span class="p">(</span><span class="n">UICollectionViewLayoutAttributes</span> <span class="o">*</span><span class="p">)</span><span class="nf">initialLayoutAttributesForInsertedItemAtIndexPath</span><span class="p">:(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">itemIndexPath</span>
<span class="p">{</span>
    <span class="n">UICollectionViewLayoutAttributes</span><span class="o">*</span> <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">layoutAttributesForItemAtIndexPath</span><span class="p">:</span><span class="n">itemIndexPath</span><span class="p">];</span>
    <span class="n">attributes</span><span class="p">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">attributes</span><span class="p">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">CGPointMake</span><span class="p">(</span><span class="n">_center</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">_center</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">attributes</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//åˆ é™¤æ—¶ï¼Œcellåœ¨åœ†å¿ƒä½ç½®ï¼Œå…¨é€æ˜ï¼Œä¸”åªæœ‰åŸæ¥çš„1/10å¤§</span>
<span class="k">-</span> <span class="p">(</span><span class="n">UICollectionViewLayoutAttributes</span> <span class="o">*</span><span class="p">)</span><span class="nf">finalLayoutAttributesForDeletedItemAtIndexPath</span><span class="p">:(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">itemIndexPath</span>
<span class="p">{</span>
    <span class="n">UICollectionViewLayoutAttributes</span><span class="o">*</span> <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">layoutAttributesForItemAtIndexPath</span><span class="p">:</span><span class="n">itemIndexPath</span><span class="p">];</span>
    <span class="n">attributes</span><span class="p">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">attributes</span><span class="p">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">CGPointMake</span><span class="p">(</span><span class="n">_center</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">_center</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="n">attributes</span><span class="p">.</span><span class="n">transform3D</span> <span class="o">=</span> <span class="n">CATransform3DMakeScale</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">attributes</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>åœ¨æ’å…¥æˆ–åˆ é™¤æ—¶ï¼Œå°†åˆ†åˆ«ä»¥æ’å…¥å‰å’Œåˆ é™¤åçš„attributeså’Œæ™®é€šçŠ¶æ€ä¸‹çš„attributesä¸ºåŸºå‡†ï¼Œè¿›è¡ŒUIViewçš„åŠ¨ç”»è¿‡æ¸¡ã€‚è€Œè¿™ä¸€åˆ‡å¹¶æ²¡æœ‰å¾ˆå¤šä»£ç è¦å†™ï¼Œå‡ ä¹æ˜¯freeçš„ï¼Œæ„Ÿè°¢è‹¹æœâ€¦</p>

<hr />

<h2 id="å¸ƒå±€ä¹‹é—´çš„åˆ‡æ¢">å¸ƒå±€ä¹‹é—´çš„åˆ‡æ¢</h2>

<p>æœ‰æ—¶å€™å¯èƒ½éœ€è¦ä¸åŒçš„å¸ƒå±€ï¼ŒAppleä¹Ÿæä¾›äº†æ–¹ä¾¿çš„å¸ƒå±€é—´åˆ‡æ¢çš„æ–¹æ³•ã€‚ç›´æ¥æ›´æ”¹collectionViewçš„collectionViewLayoutå±æ€§å¯ä»¥ç«‹å³åˆ‡æ¢å¸ƒå±€ã€‚è€Œå¦‚æœé€šè¿‡setCollectionViewLayout:animated:ï¼Œåˆ™å¯ä»¥åœ¨åˆ‡æ¢å¸ƒå±€çš„åŒæ—¶ï¼Œä½¿ç”¨åŠ¨ç”»æ¥è¿‡æ¸¡ã€‚å¯¹äºæ¯ä¸€ä¸ªcellï¼Œéƒ½å°†æœ‰å¯¹åº”çš„UIViewåŠ¨ç”»è¿›è¡Œå¯¹åº”ï¼Œåˆæ˜¯ä¸€ä¸ªæ¥è¿‘freeçš„ç‰¹æ€§ã€‚</p>

<p>å¯¹äºæˆ‘è‡ªå·±æ¥è¯´ï¼ŒUICollectionViewå¯èƒ½æ˜¯æˆ‘è½¬å‘iOS 6 SDKçš„æœ€å…·æœ‰å¸å¼•åŠ›çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œå› ä¸ºUIKitå›¢é˜Ÿçš„åŠªåŠ›å’ŒCoreAnimationçš„æˆç†Ÿï¼Œä½¿å¾—åˆ›å»ºä¸€ä¸ªæ¼‚äº®ä¼˜é›…çš„UIå˜çš„è¶Šæ¥è¶Šç®€å•äº†ã€‚å¯ä»¥æ–­è¨€è¯´UICollectionViewåœ¨ä»Šåçš„iOSå¼€å‘ä¸­ï¼Œä¸€å®šä¼šæˆä¸ºå’ŒUITableViewä¸€æ ·çš„å¼ºå¤§å’Œæœ€å¸¸ç”¨çš„ç±»ä¹‹ä¸€ã€‚åœ¨iOS 6è¿˜æœªæ­£å¼ä¸Šå¸‚å‰ï¼Œå…ˆå¯¹å…¶ç‰¹æ€§è¿›è¡Œä¸€äº›å­¦ä¹ ï¼Œä»¥æœŸå°½å¿«èƒ½ä½¿ç”¨æ–°ç‰¹æ€§æ¥ç®€åŒ–å¼€å‘æµç¨‹ï¼Œå¯ä»¥è¯´æ˜¯éå¸¸å€¼å¾—çš„ã€‚</p>
:ET