I"v×<p><img src="/assets/images/2013/ios-transition-banner.jpg" alt="iOS7ä¸­çš„ViewControlleråˆ‡æ¢" /></p>

<p>è¿™æ˜¯æˆ‘çš„WWDC2013ç³»åˆ—ç¬”è®°ä¸­çš„ä¸€ç¯‡ï¼Œå®Œæ•´çš„ç¬”è®°åˆ—è¡¨è¯·å‚çœ‹<a href="http://onevcat.com/2013/06/developer-should-know-about-ios7/">è¿™ç¯‡æ€»è§ˆ</a>ã€‚æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººè®°å½•ä½¿ç”¨ï¼Œä¹Ÿæ¬¢è¿åœ¨<a href="http://creativecommons.org/licenses/by-nc/3.0/deed.zh">è®¸å¯åè®®</a>èŒƒå›´å†…è½¬è½½æˆ–ä½¿ç”¨ï¼Œä½†æ˜¯è¿˜çƒ¦è¯·ä¿ç•™åŸæ–‡é“¾æ¥ï¼Œè°¢è°¢æ‚¨çš„ç†è§£åˆä½œã€‚å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<a href="http://onevcat.com/atom.xml">RSS</a>æˆ–<a href="http://eepurl.com/wNSkj">é‚®ä»¶</a>æ–¹å¼è®¢é˜…æœ¬ç«™ï¼Œè¿™æ ·æ‚¨å°†èƒ½åœ¨ç¬¬ä¸€æ—¶é—´è·å–æœ¬ç«™ä¿¡æ¯ã€‚</p>

<p>æœ¬æ–‡æ¶‰åŠåˆ°çš„WWDC2013 Sessionæœ‰</p>

<ul>
  <li>Session 201 Building User Interfaces for iOS 7</li>
  <li>Session 218 Custom Transitions Using View Controllers</li>
  <li>Session 226 Implementing Engaging UI on iOS</li>
</ul>

<p>æ¯«æ— ç–‘é—®ï¼ŒViewControllerï¼ˆåœ¨æœ¬æ–‡ä¸­ç®€å†™ä¸ºVCï¼‰æ˜¯ä½¿ç”¨MVCæ„å»ºCocoaæˆ–è€…CocoaTouchç¨‹åºæ—¶æœ€é‡è¦çš„ä¸€ä¸ªç±»ï¼Œæˆ‘ä»¬çš„æ—¥å¸¸å·¥ä½œä¸­ä¸€èˆ¬æ¥è¯´æœ€èŠ±è´¹æ—¶é—´å’Œç²¾åŠ›çš„ä¹Ÿæ˜¯åœ¨ä¸ºVCéƒ¨åˆ†ç¼–å†™ä»£ç ã€‚è‹¹æœäº§å“æ˜¯æ³¨é‡ç”¨æˆ·ä½“éªŒçš„ï¼Œè€Œå¯¹ç»†èŠ‚è¿›è¡Œç¢ç£¨ä¹Ÿæ˜¯è‹¹æœå¯¹äºå¼€å‘è€…ä¸€ç›´ä»¥æ¥çš„è¦æ±‚å’Œå¸Œæœ›ã€‚åœ¨ç”¨æˆ·ä½“éªŒä¸­ï¼ŒVCä¹‹é—´çš„å…³ç³»ï¼Œæ¯”å¦‚ä¸åŒVCä¹‹é—´è¿ç§»å’Œè½¬æ¢åŠ¨ç”»æ•ˆæœä¸€ç›´æ˜¯ä¸€ä¸ªå€¼å¾—ä¸æ–­æ¨æ•²çš„é‡ç‚¹ã€‚åœ¨iOS7ä¸­ï¼Œè‹¹æœç»™å‡ºäº†ä¸€å¥—å®Œæ•´çš„VCåˆ¶ä½œä¹‹é—´è¿ç§»æ•ˆæœçš„æ–¹æ¡ˆï¼Œå¯ä»¥è¯´æ˜¯ä¸ºç°åœ¨è¿™éƒ¨åˆ†å„ç§ä¸åŒå®ç°æ–¹æ¡ˆæŒ‡å‡ºäº†ä¸€æ¡æ¨èçš„ç»Ÿä¸€é“è·¯ã€‚</p>

<h3 id="ios-7-sdkä¹‹å‰çš„vcåˆ‡æ¢è§£å†³æ–¹æ¡ˆ">iOS 7 SDKä¹‹å‰çš„VCåˆ‡æ¢è§£å†³æ–¹æ¡ˆ</h3>

<p>åœ¨æ·±å…¥iOS 7çš„VCåˆ‡æ¢æ•ˆæœçš„æ–°APIå®ç°ä¹‹å‰ï¼Œå…ˆè®©æˆ‘ä»¬å›é¡¾ä¸‹ç°åœ¨çš„ä¸€èˆ¬åšæ³•å§ã€‚è¿™å¯ä»¥å¸®åŠ©ç†è§£ä¸ºä»€ä¹ˆiOS7è¦å¯¹VCåˆ‡æ¢ç»™å‡ºæ–°çš„è§£å†³æ–¹æ¡ˆï¼Œå¦‚æœæ‚¨å¯¹iOS 5ä¸­å¼•å…¥çš„VCå®¹å™¨æ¯”è¾ƒç†Ÿæ‚‰çš„è¯ï¼Œå¯ä»¥è·³è¿‡è¿™èŠ‚ã€‚</p>

<p>åœ¨iOS5å’ŒiOS6ä¸­ï¼Œé™¤äº†æ ‡å‡†çš„Pushï¼ŒTabå’ŒPresentModalä¹‹å¤–ï¼Œä¸€èˆ¬æ˜¯ä½¿ç”¨ChildViewControllerçš„æ–¹å¼æ¥å®ŒæˆVCä¹‹é—´åˆ‡æ¢çš„è¿‡æ¸¡æ•ˆæœã€‚ChildViewControllerå’Œè‡ªå®šä¹‰çš„Controllerå®¹å™¨æ˜¯iOS 5 SDKä¸­åŠ å…¥çš„ï¼Œå¯ä»¥ç”¨æ¥ç”Ÿæˆè‡ªå®šä¹‰çš„VCå®¹å™¨ï¼Œç®€å•æ¥è¯´å…¸å‹çš„ä¸€ç§ç”¨æ³•ç±»ä¼¼è¿™æ ·ï¼š</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//ContainerVC.m</span>

<span class="p">[</span><span class="n">self</span> <span class="nf">addChildViewController</span><span class="p">:</span><span class="n">toVC</span><span class="p">];</span>
<span class="p">[</span><span class="n">fromVC</span> <span class="nf">willMoveToParentViewController</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
<span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nf">addSubview</span><span class="p">:</span><span class="n">toVC</span><span class="p">.</span><span class="n">view</span><span class="p">];</span>

<span class="n">__weak</span> <span class="n">id</span> <span class="n">weakSelf</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
<span class="p">[</span><span class="n">self</span> <span class="nf">transitionFromViewController</span><span class="p">:</span><span class="n">fromVC</span>
                  <span class="nl">toViewController:</span><span class="n">toVC</span> <span class="nf">duration</span><span class="p">:</span><span class="mi">0</span><span class="p">.</span><span class="mi">3</span>
                           <span class="n">options</span><span class="o">:</span><span class="n">UIViewAnimationOptionTransitionCrossDissolve</span>
                        <span class="n">animations</span><span class="o">:^</span><span class="p">{}</span>
                        <span class="n">completion</span><span class="o">:^</span><span class="p">(</span><span class="n">BOOL</span> <span class="n">finished</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">fromVC</span><span class="p">.</span><span class="n">view</span> <span class="nf">removeFromSuperView</span><span class="p">];</span>
    <span class="p">[</span><span class="n">fromVC</span> <span class="nf">removeFromParentViewController</span><span class="p">];</span>
    <span class="p">[</span><span class="n">toVC</span> <span class="nf">didMoveToParentViewController</span><span class="p">:</span><span class="n">weakSelf</span><span class="p">];</span>
<span class="p">}];</span>
</code></pre></div></div>

<p>åœ¨è‡ªå·±å¯¹viewè¿›è¡Œç®¡ç†çš„åŒæ—¶ï¼Œå¯ä»¥ä½¿ç”¨transitionFromViewController:toViewController:â€¦çš„Animation blockä¸­å¯ä»¥å®ç°ä¸€äº›ç®€å•çš„åˆ‡æ¢æ•ˆæœã€‚å»å¹´å¹´åˆæˆ‘å†™çš„<a href="http://onevcat.com/2012/02/uiviewcontroller/">UIViewControllerçš„è¯¯ç”¨</a>ä¸€æ–‡ä¸­æ›¾ç»æŒ‡å‡ºç±»ä¼¼<code class="highlighter-rouge">[viewController.view addSubview:someOtherViewController.view];</code>è¿™æ ·çš„ä»£ç çš„å­˜åœ¨ï¼Œä¸€èˆ¬å°±æ˜¯è¯¯ç”¨VCã€‚è¿™ä¸ªç»“è®ºé€‚ç”¨äºéControllerå®¹å™¨ï¼Œå¯¹äºè‡ªå®šä¹‰çš„Controllerå®¹å™¨æ¥è¯´ï¼Œå‘å½“å‰viewä¸Šæ·»åŠ å…¶ä»–VCçš„viewæ˜¯æ­£ç¡®çš„åšæ³•ï¼ˆå½“ç„¶ä¸èƒ½å¿˜äº†ä¹Ÿå°†VCæœ¬èº«é€šè¿‡<code class="highlighter-rouge">addChildViewController:</code>æ–¹æ³•æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼‰ã€‚</p>

<p>VCå®¹å™¨çš„ä¸»è¦ç›®çš„æ˜¯è§£å†³å°†ä¸åŒVCæ·»åŠ åˆ°åŒä¸€ä¸ªå±å¹•ä¸Šçš„éœ€æ±‚ï¼Œä»¥åŠå¯ä»¥æä¾›ä¸€äº›ç®€å•çš„è‡ªå®šä¹‰åˆ‡æ¢æ•ˆæœã€‚ä½¿ç”¨VCå®¹å™¨å¯ä»¥ä½¿viewçš„å…³ç³»æ­£ç¡®ï¼Œä½¿æ·»åŠ çš„VCèƒ½å¤Ÿæ­£ç¡®æ¥æ”¶åˆ°ä¾‹å¦‚å±å¹•æ—‹è½¬ï¼ŒviewDidLoad:ç­‰VCäº‹ä»¶ï¼Œè¿›è€Œè¿›è¡Œæ­£ç¡®ç›¸åº”ã€‚VCå®¹å™¨ç¡®å®å¯ä»¥è§£å†³ä¸€éƒ¨åˆ†é—®é¢˜ï¼Œä½†æ˜¯ä¹Ÿåº”è¯¥çœ‹åˆ°ï¼Œå¯¹äºè‡ªå®šä¹‰åˆ‡æ¢æ•ˆæœæ¥è¯´ï¼Œè¿™æ ·çš„è§£å†³è¿˜æœ‰å¾ˆå¤šä¸è¶³ã€‚é¦–å…ˆæ˜¯ä»£ç é«˜åº¦è€¦åˆï¼ŒVCåˆ‡æ¢éƒ¨åˆ†çš„ä»£ç ç›´æ¥å†™åœ¨containerä¸­ï¼Œéš¾ä»¥åˆ†ç¦»é‡ç”¨ï¼›å…¶æ¬¡èƒ½å¤Ÿæä¾›çš„åˆ‡æ¢æ•ˆæœæ¯”è¾ƒæœ‰é™ï¼Œåªèƒ½ä½¿ç”¨UIViewåŠ¨ç”»æ¥åˆ‡æ¢ï¼Œç®¡ç†èµ·æ¥ä¹Ÿç•¥æ˜¾éº»çƒ¦ã€‚iOS 7æä¾›äº†ä¸€å¥—æ–°çš„è‡ªå®šä¹‰VCåˆ‡æ¢ï¼Œå°±æ˜¯é’ˆå¯¹è¿™ä¸¤ä¸ªé—®é¢˜çš„ã€‚</p>

<h3 id="ios-7-è‡ªå®šä¹‰viewcontrolleråŠ¨ç”»åˆ‡æ¢">iOS 7 è‡ªå®šä¹‰ViewControlleråŠ¨ç”»åˆ‡æ¢</h3>

<h4 id="è‡ªå®šä¹‰åŠ¨ç”»åˆ‡æ¢çš„ç›¸å…³çš„ä¸»è¦api">è‡ªå®šä¹‰åŠ¨ç”»åˆ‡æ¢çš„ç›¸å…³çš„ä¸»è¦API</h4>

<p>åœ¨æ·±å…¥ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ–°SDKä¸­æœ‰å…³è¿™éƒ¨åˆ†å†…å®¹çš„ç›¸å…³æ¥å£ä»¥åŠå®ƒä»¬çš„å…³ç³»å’Œå…¸å‹ç”¨æ³•ã€‚è¿™å‡ ä¸ªæ¥å£å’Œç±»çš„åå­—éƒ½æ¯”è¾ƒç›¸ä¼¼ï¼Œä½†æ˜¯è¿˜æ˜¯èƒ½æ¯”è¾ƒå¥½çš„æè¿°å‡ºå„è‡ªçš„èŒèƒ½çš„ï¼Œä¸€å¼€å§‹çš„è¯å¯èƒ½æ¯”è¾ƒè¿·æƒ‘ï¼Œä½†æ˜¯å½“è‡ªå·±åŠ¨æ‰‹å®ç°ä¸€ä¸¤ä¸ªä¾‹å­ä¹‹åï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»å°±ä¼šé€æ¸æ˜æ™°èµ·æ¥ã€‚ï¼ˆç›¸å…³çš„å†…å®¹éƒ½å®šä¹‰åœ¨UIKitçš„<a href="https://gist.github.com/onevcat/6944809">UIViewControllerTransitioning.h</a>ä¸­äº†ï¼‰</p>

<h4 id="protocol-uiviewcontrollercontexttransitioning">@protocol <a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIViewControllerContextTransitioning_protocol/Reference/Reference.html">UIViewControllerContextTransitioning</a></h4>

<p>è¿™ä¸ªæ¥å£ç”¨æ¥æä¾›åˆ‡æ¢ä¸Šä¸‹æ–‡ç»™å¼€å‘è€…ä½¿ç”¨ï¼ŒåŒ…å«äº†ä»å“ªä¸ªVCåˆ°å“ªä¸ªVCç­‰å„ç±»ä¿¡æ¯ï¼Œä¸€èˆ¬ä¸éœ€è¦å¼€å‘è€…è‡ªå·±å®ç°ã€‚å…·ä½“æ¥è¯´ï¼ŒiOS7çš„è‡ªå®šä¹‰åˆ‡æ¢ç›®çš„ä¹‹ä¸€å°±æ˜¯åˆ‡æ¢ç›¸å…³ä»£ç è§£è€¦ï¼Œåœ¨è¿›è¡ŒVCåˆ‡æ¢æ—¶ï¼Œåšåˆ‡æ¢æ•ˆæœå®ç°çš„æ—¶å€™å¿…é¡»è¦éœ€è¦åˆ‡æ¢å‰åVCçš„ä¸€äº›ä¿¡æ¯ï¼Œ<strong>ç³»ç»Ÿåœ¨æ–°åŠ å…¥çš„APIçš„æ¯”è¾ƒçš„åœ°æ–¹éƒ½ä¼šæä¾›ä¸€ä¸ªå®ç°äº†è¯¥æ¥å£çš„å¯¹è±¡</strong>ï¼Œä»¥ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚</p>

<p><strong>å¯¹äºåˆ‡æ¢çš„åŠ¨ç”»å®ç°æ¥è¯´</strong>ï¼ˆè¿™é‡Œå…ˆä»‹ç»ç®€å•çš„åŠ¨ç”»ï¼Œåœ¨åé¢æˆ‘ä¼šå†å¼•å…¥æ‰‹åŠ¿é©±åŠ¨çš„åŠ¨ç”»ï¼‰ï¼Œè¿™ä¸ªæ¥å£ä¸­æœ€é‡è¦çš„æ–¹æ³•æœ‰ï¼š</p>

<ul>
  <li>-(UIView *)containerView; VCåˆ‡æ¢æ‰€å‘ç”Ÿçš„viewå®¹å™¨ï¼Œå¼€å‘è€…åº”è¯¥å°†åˆ‡å‡ºçš„viewç§»é™¤ï¼Œå°†åˆ‡å…¥çš„viewåŠ å…¥åˆ°è¯¥viewå®¹å™¨ä¸­ã€‚</li>
  <li>-(UIViewController *)viewControllerForKey:(NSString *)key; æä¾›ä¸€ä¸ªkeyï¼Œè¿”å›å¯¹åº”çš„VCã€‚ç°åœ¨çš„SDKä¸­keyçš„é€‰æ‹©åªæœ‰UITransitionContextFromViewControllerKeyå’ŒUITransitionContextToViewControllerKeyä¸¤ç§ï¼Œåˆ†åˆ«è¡¨ç¤ºå°†è¦åˆ‡å‡ºå’Œåˆ‡å…¥çš„VCã€‚</li>
  <li>-(CGRect)initialFrameForViewController:(UIViewController *)vc; æŸä¸ªVCçš„åˆå§‹ä½ç½®ï¼Œå¯ä»¥ç”¨æ¥åšåŠ¨ç”»çš„è®¡ç®—ã€‚</li>
  <li>-(CGRect)finalFrameForViewController:(UIViewController *)vc; ä¸ä¸Šé¢çš„æ–¹æ³•å¯¹åº”ï¼Œå¾—åˆ°åˆ‡æ¢ç»“æŸæ—¶æŸä¸ªVCåº”åœ¨çš„frameã€‚</li>
  <li>-(void)completeTransition:(BOOL)didComplete; å‘è¿™ä¸ªcontextæŠ¥å‘Šåˆ‡æ¢å·²ç»å®Œæˆã€‚</li>
</ul>

<h4 id="protocol-uiviewcontrolleranimatedtransitioning">@protocol <a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIViewControllerAnimatedTransitioning_Protocol/Reference/Reference.html">UIViewControllerAnimatedTransitioning</a></h4>

<p>è¿™ä¸ªæ¥å£è´Ÿè´£åˆ‡æ¢çš„å…·ä½“å†…å®¹ï¼Œä¹Ÿå³â€œåˆ‡æ¢ä¸­åº”è¯¥å‘ç”Ÿä»€ä¹ˆâ€ã€‚å¼€å‘è€…åœ¨åšè‡ªå®šä¹‰åˆ‡æ¢æ•ˆæœæ—¶å¤§éƒ¨åˆ†ä»£ç ä¼šæ˜¯ç”¨æ¥å®ç°è¿™ä¸ªæ¥å£ã€‚å®ƒåªæœ‰ä¸¤ä¸ªæ–¹æ³•éœ€è¦æˆ‘ä»¬å®ç°ï¼š</p>

<ul>
  <li>
    <p>-(NSTimeInterval)transitionDuration:(id &lt; UIViewControllerContextTransitioning &gt;)transitionContext; ç³»ç»Ÿç»™å‡ºä¸€ä¸ªåˆ‡æ¢ä¸Šä¸‹æ–‡ï¼Œæˆ‘ä»¬æ ¹æ®ä¸Šä¸‹æ–‡ç¯å¢ƒè¿”å›è¿™ä¸ªåˆ‡æ¢æ‰€éœ€è¦çš„èŠ±è´¹æ—¶é—´ï¼ˆä¸€èˆ¬å°±è¿”å›åŠ¨ç”»çš„æ—¶é—´å°±å¥½äº†ï¼ŒSDKä¼šç”¨è¿™ä¸ªæ—¶é—´æ¥åœ¨ç™¾åˆ†æ¯”é©±åŠ¨çš„åˆ‡æ¢ä¸­è¿›è¡Œå¸§çš„è®¡ç®—ï¼Œåé¢å†è¯¦ç»†å±•å¼€ï¼‰ã€‚</p>
  </li>
  <li>
    <p>-(void)animateTransition:(id &lt; UIViewControllerContextTransitioning &gt;)transitionContext; åœ¨è¿›è¡Œåˆ‡æ¢çš„æ—¶å€™å°†è°ƒç”¨è¯¥æ–¹æ³•ï¼Œæˆ‘ä»¬å¯¹äºåˆ‡æ¢æ—¶çš„UIViewçš„è®¾ç½®å’ŒåŠ¨ç”»éƒ½åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å®Œæˆã€‚</p>
  </li>
</ul>

<h4 id="protocol-uiviewcontrollertransitioningdelegate">@protocol <a href="https://developer.apple.com/library/ios/documentation/uikit/reference/UIViewControllerTransitioningDelegate_protocol/Reference/Reference.html">UIViewControllerTransitioningDelegate</a></h4>

<p>è¿™ä¸ªæ¥å£çš„ä½œç”¨æ¯”è¾ƒç®€å•å•ä¸€ï¼Œåœ¨éœ€è¦VCåˆ‡æ¢çš„æ—¶å€™ç³»ç»Ÿä¼šåƒå®ç°äº†è¿™ä¸ªæ¥å£çš„å¯¹è±¡è¯¢é—®æ˜¯å¦éœ€è¦ä½¿ç”¨è‡ªå®šä¹‰çš„åˆ‡æ¢æ•ˆæœã€‚è¿™ä¸ªæ¥å£å…±æœ‰å››ä¸ªç±»ä¼¼çš„æ–¹æ³•ï¼š</p>

<ul>
  <li>
    <p>-(id&lt; UIViewControllerAnimatedTransitioning &gt;)animationControllerForPresentedController:(UIViewController *)presented presentingController:(UIViewController *)presenting sourceController:(UIViewController *)source;</p>
  </li>
  <li>
    <p>-(id&lt; UIViewControllerAnimatedTransitioning &gt;)animationControllerForDismissedController:(UIViewController *)dismissed;</p>
  </li>
  <li>
    <p>-(id&lt; UIViewControllerInteractiveTransitioning &gt;)interactionControllerForPresentation:(id &lt; UIViewControllerAnimatedTransitioning &gt;)animator;</p>
  </li>
  <li>
    <p>-(id&lt; UIViewControllerInteractiveTransitioning &gt;)interactionControllerForDismissal:(id &lt; UIViewControllerAnimatedTransitioning &gt;)animator;</p>
  </li>
</ul>

<p>å‰ä¸¤ä¸ªæ–¹æ³•æ˜¯é’ˆå¯¹åŠ¨ç”»åˆ‡æ¢çš„ï¼Œæˆ‘ä»¬éœ€è¦åˆ†åˆ«åœ¨å‘ˆç°VCå’Œè§£æ•£VCæ—¶ï¼Œç»™å‡ºä¸€ä¸ªå®ç°äº†UIViewControllerAnimatedTransitioningæ¥å£çš„å¯¹è±¡ï¼ˆå…¶ä¸­åŒ…å«åˆ‡æ¢æ—¶é•¿å’Œå¦‚ä½•åˆ‡æ¢ï¼‰ã€‚åä¸¤ä¸ªæ–¹æ³•æ¶‰åŠäº¤äº’å¼åˆ‡æ¢ï¼Œä¹‹åå†è¯´ã€‚</p>

<h3 id="demo">Demo</h3>

<p>è¿˜æ˜¯é‚£å¥è¯ï¼Œä¸€ç™¾è¡Œçš„è®²è§£ä¸å¦‚ä¸€ä¸ªç®€å•çš„å°Demoï¼Œäºæ˜¯..itâ€™s demo timeï½ æ•´ä¸ªdemoçš„ä»£ç æˆ‘æ”¾åˆ°äº†githubçš„<a href="https://github.com/onevcat/VCTransitionDemo">è¿™ä¸ªé¡µé¢</a>ä¸Šï¼Œæœ‰éœ€è¦çš„æœ‹å‹å¯ä»¥å‚ç…§ç€çœ‹è¿™ç¯‡æ–‡ç« ã€‚</p>

<p>æˆ‘ä»¬æ‰“ç®—åšä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰çš„modalViewControllerçš„åˆ‡æ¢æ•ˆæœã€‚æ™®é€šçš„present modal VCçš„æ•ˆæœå¤§å®¶éƒ½å·²ç»å¾ˆç†Ÿæ‚‰äº†ï¼Œè¿™æ¬¡æˆ‘ä»¬å…ˆå®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„ç±»ä¼¼çš„modal presentçš„æ•ˆæœï¼Œä¸æ™®é€šæ•ˆæœä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›modalVCå‡ºç°çš„æ—¶å€™ä¸è¦é‚£ä¹ˆä¹å‘³çš„å°±ç®€å•ä»åº•éƒ¨å‡ºç°ï¼Œè€Œæ˜¯å¸¦æœ‰ä¸€ä¸ªå¼¹æ€§æ•ˆæœï¼ˆè¿™é‡Œè™½ç„¶æ˜¯å¼¹æ€§ï¼Œä½†æ˜¯ä»…æŒ‡ä½¿ç”¨UIViewçš„æ¨¡æ‹ŸåŠ¨ç”»ï¼Œè€Œä¸è®¾è®¡iOS 7çš„å¦ä¸€ä¸ªé‡è¦ç‰¹æ€§UIKit Dynamicsã€‚ç”¨UIKit Dynamicså½“ç„¶ä¹Ÿè®¸å¯ä»¥å®ç°æ›´é€¼çœŸåä¸½çš„æ•ˆæœï¼Œä½†æ˜¯å·²ç»è¶…å‡ºæœ¬æ–‡çš„ä¸»é¢˜èŒƒç•´äº†ï¼Œå› æ­¤ä¸åœ¨è¿™é‡Œå±•å¼€äº†ã€‚å…³äºUIKit Dynamicsï¼Œå¯ä»¥å‚çœ‹æˆ‘ä¹‹å‰å…³äºè¿™ä¸ªä¸»é¢˜çš„<a href="http://onevcat.com/2013/06/uikit-dynamics-started/">ä¸€ç¯‡ä»‹ç»</a>ï¼‰ã€‚æˆ‘ä»¬é¦–å…ˆå®ç°ç®€å•çš„ModalVCå¼¹å‡ºå§..è¿™æ®µéå¸¸åŸºç¡€ï¼Œå°±äº¤å¾…äº†ä¸€ä¸‹èƒŒæ™¯ï¼Œéåˆçº§äººå£«è¯·è·³è¿‡ä»£ç æ®µ..</p>

<p>å…ˆå®šä¹‰ä¸€ä¸ªModalVCï¼Œä»¥åŠç›¸åº”çš„protocalå’Œdelegateæ–¹æ³•ï¼š</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//ModalViewController.h</span>

<span class="k">@class</span> <span class="nc">ModalViewController</span><span class="p">;</span>
<span class="k">@protocol</span> <span class="nc">ModalViewControllerDelegate</span> <span class="o">&lt;</span><span class="n">NSObject</span><span class="o">&gt;</span>

<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">modalViewControllerDidClickedDismissButton</span><span class="p">:(</span><span class="n">ModalViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">viewController</span><span class="p">;</span>

<span class="k">@end</span>

<span class="k">@interface</span> <span class="nc">ModalViewController</span> <span class="p">:</span> <span class="nc">UIViewController</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">weak</span><span class="p">)</span> <span class="n">id</span><span class="o">&lt;</span><span class="n">ModalViewControllerDelegate</span><span class="o">&gt;</span> <span class="n">delegate</span><span class="p">;</span>
<span class="k">@end</span>

<span class="c1">//ModalViewController.m</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">viewDidLoad</span><span class="p">];</span>
	<span class="c1">// Do any additional setup after loading the view.</span>
    <span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="nf">lightGrayColor</span><span class="p">];</span>
    
    <span class="n">UIButton</span> <span class="o">*</span><span class="n">button</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIButton</span> <span class="nf">buttonWithType</span><span class="p">:</span><span class="n">UIButtonTypeRoundedRect</span><span class="p">];</span>
    <span class="n">button</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">80</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">210</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">160</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">[</span><span class="n">button</span> <span class="nf">setTitle</span><span class="p">:</span><span class="s">@"Dismiss me"</span> <span class="nf">forState</span><span class="p">:</span><span class="n">UIControlStateNormal</span><span class="p">];</span>
    <span class="p">[</span><span class="n">button</span> <span class="nf">addTarget</span><span class="p">:</span><span class="n">self</span> <span class="nf">action</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">buttonClicked</span><span class="o">:</span><span class="p">)</span> <span class="n">forControlEvents</span><span class="o">:</span><span class="n">UIControlEventTouchUpInside</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nf">addSubview</span><span class="p">:</span><span class="n">button</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">buttonClicked</span><span class="p">:(</span><span class="n">id</span><span class="p">)</span><span class="nv">sender</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">delegate</span> <span class="o">&amp;&amp;</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">delegate</span> <span class="nf">respondsToSelector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="nf">modalViewControllerDidClickedDismissButton</span><span class="p">:)])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">delegate</span> <span class="nf">modalViewControllerDidClickedDismissButton</span><span class="p">:</span><span class="n">self</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>è¿™ä¸ªæ˜¯å¾ˆæ ‡å‡†çš„modalViewControllerçš„å®ç°æ–¹å¼äº†ã€‚éœ€è¦å¤šå˜´ä¸€å¥çš„æ˜¯ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­æœ‰çš„åŒå­¦å–œæ¬¢åœ¨-buttonClicked:ä¸­ç›´æ¥ç»™selfå‘é€dismissViewControllerçš„ç›¸å…³æ–¹æ³•ã€‚åœ¨ç°åœ¨çš„SDKä¸­ï¼Œå¦‚æœå½“å‰çš„VCæ˜¯è¢«æ˜¾ç¤ºçš„è¯ï¼Œè¿™ä¸ªæ¶ˆæ¯ä¼šè¢«ç›´æ¥è½¬å‘åˆ°æ˜¾ç¤ºå®ƒçš„VCå»ã€‚ä½†æ˜¯è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„å®ç°ï¼Œè¿åäº†ç¨‹åºè®¾è®¡çš„å“²å­¦ï¼Œä¹Ÿå¾ˆå®¹æ˜“æ‰åˆ°å‘é‡Œï¼Œå…·ä½“æ¡ˆä¾‹å¯ä»¥å‚çœ‹<a href="http://onevcat.com/2011/11/objc-block/">è¿™ç¯‡æ–‡ç« çš„è¯„è®º</a>ã€‚</p>

<p>æ‰€ä»¥æˆ‘ä»¬ç”¨æ ‡å‡†çš„æ–¹å¼æ¥å‘ˆç°å’Œè§£æ•£è¿™ä¸ªVCï¼š</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//MainViewController.m</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">viewDidLoad</span><span class="p">];</span>
	<span class="c1">// Do any additional setup after loading the view.</span>
    <span class="n">UIButton</span> <span class="o">*</span><span class="n">button</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIButton</span> <span class="nf">buttonWithType</span><span class="p">:</span><span class="n">UIButtonTypeRoundedRect</span><span class="p">];</span>
    <span class="n">button</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">80</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">210</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">160</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">[</span><span class="n">button</span> <span class="nf">setTitle</span><span class="p">:</span><span class="s">@"Click me"</span> <span class="nf">forState</span><span class="p">:</span><span class="n">UIControlStateNormal</span><span class="p">];</span>
    <span class="p">[</span><span class="n">button</span> <span class="nf">addTarget</span><span class="p">:</span><span class="n">self</span> <span class="nf">action</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">buttonClicked</span><span class="o">:</span><span class="p">)</span> <span class="n">forControlEvents</span><span class="o">:</span><span class="n">UIControlEventTouchUpInside</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nf">addSubview</span><span class="p">:</span><span class="n">button</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">buttonClicked</span><span class="p">:(</span><span class="n">id</span><span class="p">)</span><span class="nv">sender</span>
<span class="p">{</span>
    <span class="n">ModalViewController</span> <span class="o">*</span><span class="n">mvc</span> <span class="o">=</span>  <span class="p">[[</span><span class="n">ModalViewController</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="n">mvc</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">presentViewController</span><span class="p">:</span><span class="n">mvc</span> <span class="nf">animated</span><span class="p">:</span><span class="nb">YES</span> <span class="n">completion</span><span class="o">:</span><span class="nb">nil</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">modalViewControllerDidClickedDismissButton</span><span class="p">:(</span><span class="n">ModalViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">viewController</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">dismissViewControllerAnimated</span><span class="p">:</span><span class="nb">YES</span> <span class="nf">completion</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æµ‹è¯•ä¸€ä¸‹ï¼Œæ²¡é—®é¢˜ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥å¼€å§‹å®ç°è‡ªå®šä¹‰çš„åˆ‡æ¢æ•ˆæœäº†ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå®ç°äº†UIViewControllerAnimatedTransitioningçš„å¯¹è±¡..å—¯ï¼Œæ–°å»ºä¸€ä¸ªç±»æ¥å®ç°å§ï¼Œæ¯”å¦‚BouncePresentAnimationï¼š</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//BouncePresentAnimation.h</span>
<span class="k">@interface</span> <span class="nc">BouncePresentAnimation</span> <span class="p">:</span> <span class="nc">NSObject</span><span class="o">&lt;</span><span class="n">UIViewControllerAnimatedTransitioning</span><span class="o">&gt;</span>

<span class="k">@end</span>

<span class="c1">//BouncePresentAnimation.m</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSTimeInterval</span><span class="p">)</span><span class="nf">transitionDuration</span><span class="p">:(</span><span class="n">id</span> <span class="o">&lt;</span><span class="n">UIViewControllerContextTransitioning</span><span class="o">&gt;</span><span class="p">)</span><span class="nv">transitionContext</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="n">f</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">animateTransition</span><span class="p">:(</span><span class="n">id</span> <span class="o">&lt;</span><span class="n">UIViewControllerContextTransitioning</span><span class="o">&gt;</span><span class="p">)</span><span class="nv">transitionContext</span>
<span class="p">{</span>
    <span class="c1">// 1. Get controllers from transition context</span>
    <span class="n">UIViewController</span> <span class="o">*</span><span class="n">toVC</span> <span class="o">=</span> <span class="p">[</span><span class="n">transitionContext</span> <span class="nf">viewControllerForKey</span><span class="p">:</span><span class="n">UITransitionContextToViewControllerKey</span><span class="p">];</span>
    
    <span class="c1">// 2. Set init frame for toVC</span>
    <span class="n">CGRect</span> <span class="n">screenBounds</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIScreen</span> <span class="nf">mainScreen</span><span class="p">]</span> <span class="nf">bounds</span><span class="p">];</span>
    <span class="n">CGRect</span> <span class="n">finalFrame</span> <span class="o">=</span> <span class="p">[</span><span class="n">transitionContext</span> <span class="nf">finalFrameForViewController</span><span class="p">:</span><span class="n">toVC</span><span class="p">];</span>
    <span class="n">toVC</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectOffset</span><span class="p">(</span><span class="n">finalFrame</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">screenBounds</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">);</span>
    
    <span class="c1">// 3. Add toVC's view to containerView</span>
    <span class="n">UIView</span> <span class="o">*</span><span class="n">containerView</span> <span class="o">=</span> <span class="p">[</span><span class="n">transitionContext</span> <span class="nf">containerView</span><span class="p">];</span>
    <span class="p">[</span><span class="n">containerView</span> <span class="nf">addSubview</span><span class="p">:</span><span class="n">toVC</span><span class="p">.</span><span class="n">view</span><span class="p">];</span>
    
    <span class="c1">// 4. Do animate now</span>
    <span class="n">NSTimeInterval</span> <span class="n">duration</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">transitionDuration</span><span class="p">:</span><span class="n">transitionContext</span><span class="p">];</span>
    <span class="p">[</span><span class="n">UIView</span> <span class="nf">animateWithDuration</span><span class="p">:</span><span class="n">duration</span>
                          <span class="nl">delay:</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span>
         <span class="nl">usingSpringWithDamping:</span><span class="mi">0</span><span class="p">.</span><span class="mi">6</span>
          <span class="nl">initialSpringVelocity:</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span>
                        <span class="nl">options:</span><span class="n">UIViewAnimationOptionCurveLinear</span>
                     <span class="nl">animations:</span><span class="o">^</span><span class="p">{</span>
                         <span class="n">toVC</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">finalFrame</span><span class="p">;</span>
                     <span class="p">}</span> <span class="nf">completion</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">BOOL</span> <span class="n">finished</span><span class="p">)</span> <span class="p">{</span>
                         <span class="c1">// 5. Tell context that we completed.</span>
                         <span class="p">[</span><span class="n">transitionContext</span> <span class="nf">completeTransition</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
                     <span class="p">}];</span>
<span class="p">}</span>
</code></pre></div></div>

<p>è§£é‡Šä¸€ä¸‹è¿™ä¸ªå®ç°ï¼š</p>

<ol>
  <li>æˆ‘ä»¬é¦–å…ˆéœ€è¦å¾—åˆ°å‚ä¸åˆ‡æ¢çš„ä¸¤ä¸ªViewControllerçš„ä¿¡æ¯ï¼Œä½¿ç”¨contextçš„æ–¹æ³•æ‹¿åˆ°å®ƒä»¬çš„å‚ç…§ï¼›</li>
  <li>å¯¹äºè¦å‘ˆç°çš„VCï¼Œæˆ‘ä»¬å¸Œæœ›å®ƒä»å±å¹•ä¸‹æ–¹å‡ºç°ï¼Œå› æ­¤å°†åˆå§‹ä½ç½®è®¾ç½®åˆ°å±å¹•ä¸‹è¾¹ç¼˜ï¼›</li>
  <li>å°†viewæ·»åŠ åˆ°containerViewä¸­ï¼›</li>
  <li>å¼€å§‹åŠ¨ç”»ã€‚è¿™é‡Œçš„åŠ¨ç”»æ—¶é—´é•¿åº¦å’Œåˆ‡æ¢æ—¶é—´é•¿åº¦ä¸€è‡´ï¼Œéƒ½ä¸º0.8sã€‚usingSpringWithDampingçš„UIViewåŠ¨ç”»APIæ˜¯iOS7æ–°åŠ å…¥çš„ï¼Œæè¿°äº†ä¸€ä¸ªæ¨¡æ‹Ÿå¼¹ç°§åŠ¨ä½œçš„åŠ¨ç”»æ›²çº¿ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œåªåšä½¿ç”¨ï¼Œæ›´å¤šä¿¡æ¯å¯ä»¥å‚çœ‹<a href="https://developer.apple.com/library/ios/documentation/uikit/reference/uiview_class/UIView/UIView.html#//apple_ref/occ/clm/UIView/animateWithDuration:delay:usingSpringWithDamping:initialSpringVelocity:options:animations:completion:">ç›¸å…³æ–‡æ¡£</a>ï¼›ï¼ˆé¡ºä¾¿å¤šè¯´ä¸€å¥ï¼ŒiOS7ä¸­å¯¹UIViewåŠ¨ç”»æ·»åŠ äº†ä¸€ä¸ªå¾ˆæ–¹ä¾¿çš„Categoryï¼ŒUIViewKeyframeAnimationsã€‚ä½¿ç”¨å…¶ä¸­æ–¹æ³•å¯ä»¥ä¸ºUIViewåŠ¨ç”»æ·»åŠ å…³é”®å¸§åŠ¨ç”»ï¼‰</li>
  <li>åœ¨åŠ¨ç”»ç»“æŸåæˆ‘ä»¬å¿…é¡»å‘contextæŠ¥å‘ŠVCåˆ‡æ¢å®Œæˆï¼Œæ˜¯å¦æˆåŠŸï¼ˆåœ¨è¿™é‡Œçš„åŠ¨ç”»åˆ‡æ¢ä¸­ï¼Œæ²¡æœ‰å¤±è´¥çš„å¯èƒ½æ€§ï¼Œå› æ­¤ç›´æ¥passä¸€ä¸ªYESè¿‡å»ï¼‰ã€‚ç³»ç»Ÿåœ¨æ¥æ”¶åˆ°è¿™ä¸ªæ¶ˆæ¯åï¼Œå°†å¯¹VCçŠ¶æ€è¿›è¡Œç»´æŠ¤ã€‚</li>
</ol>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬å®ç°ä¸€ä¸ªUIViewControllerTransitioningDelegateï¼Œåº”è¯¥å°±èƒ½è®©å®ƒå·¥ä½œäº†ã€‚ç®€å•æ¥è¯´ï¼Œä¸€ä¸ªæ¯”è¾ƒå¥½çš„åœ°æ–¹æ˜¯ç›´æ¥åœ¨MainViewControllerä¸­å®ç°è¿™ä¸ªæ¥å£ã€‚åœ¨MainVCä¸­å£°æ˜å®ç°è¿™ä¸ªæ¥å£ï¼Œç„¶ååŠ å…¥æˆ–å˜æ›´ä¸ºå¦‚ä¸‹ä»£ç ï¼š</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">@interface</span> <span class="nc">MainViewController</span> <span class="p">()</span><span class="o">&lt;</span><span class="n">ModalViewControllerDelegate</span><span class="p">,</span> <span class="n">UIViewControllerTransitioningDelegate</span><span class="o">&gt;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">BouncePresentAnimation</span> <span class="o">*</span><span class="n">presentAnimation</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">MainViewController</span>

<span class="k">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="nf">initWithNibName</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">nibNameOrNil</span> <span class="nf">bundle</span><span class="p">:(</span><span class="n">NSBundle</span> <span class="o">*</span><span class="p">)</span><span class="nv">nibBundleOrNil</span>
<span class="p">{</span>
    <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">initWithNibName</span><span class="p">:</span><span class="n">nibNameOrNil</span> <span class="nf">bundle</span><span class="p">:</span><span class="n">nibBundleOrNil</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Custom initialization</span>
        <span class="n">_presentAnimation</span> <span class="o">=</span> <span class="p">[</span><span class="n">BouncePresentAnimation</span> <span class="nf">new</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">buttonClicked</span><span class="p">:(</span><span class="n">id</span><span class="p">)</span><span class="nv">sender</span>
<span class="p">{</span>
    <span class="c1">//...</span>
    <span class="n">mvc</span><span class="p">.</span><span class="n">transitioningDelegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
    <span class="c1">//...</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="n">id</span> <span class="o">&lt;</span><span class="n">UIViewControllerAnimatedTransitioning</span><span class="o">&gt;</span><span class="p">)</span><span class="nf">animationControllerForPresentedController</span><span class="p">:(</span><span class="n">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">presented</span> <span class="nf">presentingController</span><span class="p">:(</span><span class="n">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">presenting</span> <span class="nf">sourceController</span><span class="p">:(</span><span class="n">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">source</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">presentAnimation</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Believe or not, we have done. è·‘ä¸€ä¸‹ï¼Œåº”è¯¥å¯ä»¥å¾—åˆ°å¦‚ä¸‹æ•ˆæœï¼š</p>

<p><img src="/assets/images/2013/custom-vc-transition-1.gif" alt="BouncePresentAnimationçš„å®é™…æ•ˆæœ" /></p>

<h3 id="æ‰‹åŠ¿é©±åŠ¨çš„ç™¾åˆ†æ¯”åˆ‡æ¢">æ‰‹åŠ¿é©±åŠ¨çš„ç™¾åˆ†æ¯”åˆ‡æ¢</h3>

<p>iOS7å¼•å…¥äº†ä¸€ç§æ‰‹åŠ¿é©±åŠ¨çš„VCåˆ‡æ¢çš„æ–¹å¼ï¼ˆäº¤äº’å¼åˆ‡æ¢ï¼‰ã€‚å¦‚æœä½ ä½¿ç”¨ç³»ç»Ÿçš„å„ç§åº”ç”¨ï¼Œåœ¨navViewControlleré‡Œpushäº†ä¸€ä¸ªæ–°çš„VCçš„è¯ï¼Œè¿”å›æ—¶å¹¶ä¸éœ€è¦ç‚¹å‡»å·¦ä¸Šçš„BackæŒ‰é’®ï¼Œè€Œæ˜¯é€šè¿‡ä»å±å¹•å·¦ä¾§åˆ’å‘å³ä¾§å³å¯å®Œæˆè¿”å›æ“ä½œã€‚è€Œåœ¨è¿™ä¸ªæ“ä½œè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥æ’¤é”€æˆ‘ä»¬çš„æ‰‹åŠ¿ï¼Œä»¥å–æ¶ˆè¿™æ¬¡VCè½¬ç§»ã€‚åœ¨æ–°ç‰ˆçš„Safariä¸­ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥ç”¨ç›¸åŒçš„æ‰‹åŠ¿æ¥å®Œæˆç½‘é¡µçš„åé€€åŠŸèƒ½ï¼ˆæ‰€ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šæ¥è¯´å±å¹•åº•éƒ¨çš„å·¥å…·æ æˆä¸ºäº†æ‘†è®¾ï¼‰ã€‚å¦‚æœæ‚¨è¿˜ä¸çŸ¥é“æˆ–è€…æ²¡å¤ªç•™æ„è¿‡è¿™ä¸ªæ”¹åŠ¨ï¼Œä¸å¦¨ç°åœ¨å°±æ‹¿æ‰‹è¾¹çš„iOS7è¿™è¾ˆè¯•è¯•çœ‹ï¼Œæ‰‹æœºæµè§ˆçš„æœ‹å‹è®°å¾—åˆ‡å›æ¥å“¦ :)</p>

<p>æˆ‘ä»¬è¿™å°±åŠ¨æ‰‹åœ¨è‡ªå·±çš„VCåˆ‡æ¢ä¸­å®ç°è¿™ä¸ªåŠŸèƒ½å§ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨åˆšæ‰çš„çŸ¥è¯†åŸºç¡€ä¸Šè¡¥å……ä¸€äº›ä¸œè¥¿ï¼š</p>

<p>é¦–å…ˆæ˜¯UIViewControllerContextTransitioningï¼Œåˆšæ‰æåˆ°è¿™ä¸ªæ˜¯ç³»ç»Ÿæä¾›çš„VCåˆ‡æ¢ä¸Šä¸‹æ–‡ï¼Œå¦‚æœæ‚¨æ·±å…¥çœ‹äº†å®ƒçš„å¤´æ–‡ä»¶æè¿°çš„è¯ï¼Œåº”è¯¥ä¼šå‘ç°å…¶ä¸­æœ‰ä¸‰ä¸ªå…³äºInteractiveTransitionçš„æ–¹æ³•ï¼Œæ­£æ˜¯ç”¨æ¥å¤„ç†äº¤äº’å¼åˆ‡æ¢çš„ã€‚ä½†æ˜¯åœ¨åˆçº§çš„å®é™…ä½¿ç”¨ä¸­æˆ‘ä»¬å…¶å®å¯ä»¥ä¸å¤ªç†ä¼šå®ƒä»¬ï¼Œè€Œæ˜¯ä½¿ç”¨iOS 7 SDKå·²ç»ç»™æˆ‘ä»¬å‡†å¤‡å¥½çš„ä¸€ä¸ªç°æˆè½¬ä¸ºäº¤äº’å¼åˆ‡æ¢è€Œæ–°åŠ çš„ç±»ï¼šUIPercentDrivenInteractiveTransitionã€‚</p>

<h4 id="uipercentdriveninteractivetransitionæ˜¯ä»€ä¹ˆ"><a href="https://developer.apple.com/library/ios/documentation/uikit/reference/UIPercentDrivenInteractiveTransition_class/Reference/Reference.html">UIPercentDrivenInteractiveTransition</a>æ˜¯ä»€ä¹ˆ</h4>

<p>è¿™æ˜¯ä¸€ä¸ªå®ç°äº†UIViewControllerInteractiveTransitioningæ¥å£çš„ç±»ï¼Œä¸ºæˆ‘ä»¬é¢„å…ˆå®ç°å’Œæä¾›äº†ä¸€ç³»åˆ—ä¾¿åˆ©çš„æ–¹æ³•ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªç™¾åˆ†æ¯”æ¥æ§åˆ¶äº¤äº’å¼åˆ‡æ¢çš„è¿‡ç¨‹ã€‚ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬æ›´å¤šåœ°ä¼šä½¿ç”¨æŸäº›æ‰‹åŠ¿æ¥å®Œæˆäº¤äº’å¼çš„è½¬ç§»ï¼ˆå½“ç„¶ç”¨çš„é«˜çº§çš„è¯ç”¨å…¶ä»–çš„è¾“å…¥..æ¯”å¦‚å£°éŸ³ï¼ŒiBeaconè·ç¦»æˆ–è€…ç”šè‡³é¢éƒ¨å¾®ç¬‘æ¥åšè¾“å…¥é©±åŠ¨ä¹Ÿæ— ä¸å¯ï¼Œæ¯•ç«Ÿæƒ³è±¡æ— æé™å˜›..ï¼‰ï¼Œè¿™æ ·ä½¿ç”¨è¿™ä¸ªç±»ï¼ˆä¸€èˆ¬æ˜¯å…¶å­ç±»ï¼‰çš„è¯å°±ä¼šéå¸¸æ–¹ä¾¿ã€‚æˆ‘ä»¬åœ¨æ‰‹åŠ¿è¯†åˆ«ä¸­åªéœ€è¦å‘Šè¯‰è¿™ä¸ªç±»çš„å®ä¾‹å½“å‰çš„çŠ¶æ€ç™¾åˆ†æ¯”å¦‚ä½•ï¼Œç³»ç»Ÿä¾¿æ ¹æ®è¿™ä¸ªç™¾åˆ†æ¯”å’Œæˆ‘ä»¬ä¹‹å‰è®¾å®šçš„è¿ç§»æ–¹å¼ä¸ºæˆ‘ä»¬è®¡ç®—å½“å‰åº”è¯¥çš„UIæ¸²æŸ“ï¼Œååˆ†æ–¹ä¾¿ã€‚å…·ä½“çš„å‡ ä¸ªé‡è¦æ–¹æ³•ï¼š</p>

<ul>
  <li>-(void)updateInteractiveTransition:(CGFloat)percentComplete æ›´æ–°ç™¾åˆ†æ¯”ï¼Œä¸€èˆ¬é€šè¿‡æ‰‹åŠ¿è¯†åˆ«çš„é•¿åº¦ä¹‹ç±»çš„æ¥è®¡ç®—ä¸€ä¸ªå€¼ï¼Œç„¶åè¿›è¡Œæ›´æ–°ã€‚ä¹‹åçš„ä¾‹å­é‡Œä¼šçœ‹åˆ°è¯¦ç»†çš„ç”¨æ³•</li>
  <li>-(void)cancelInteractiveTransition æŠ¥å‘Šäº¤äº’å–æ¶ˆï¼Œè¿”å›åˆ‡æ¢å‰çš„çŠ¶æ€</li>
  <li>â€“(void)finishInteractiveTransition æŠ¥å‘Šäº¤äº’å®Œæˆï¼Œæ›´æ–°åˆ°åˆ‡æ¢åçš„çŠ¶æ€</li>
</ul>

<h4 id="protocol-uiviewcontrollerinteractivetransitioning">@protocol <a href="https://developer.apple.com/library/ios/documentation/uikit/reference/UIViewControllerInteractiveTransitioning_protocol/Reference/Reference.html">UIViewControllerInteractiveTransitioning</a></h4>

<p>å°±å¦‚ä¸Šé¢æåˆ°çš„ï¼ŒUIPercentDrivenInteractiveTransitionåªæ˜¯å®ç°äº†è¿™ä¸ªæ¥å£çš„ä¸€ä¸ªç±»ã€‚ä¸ºäº†å®ç°äº¤äº’å¼åˆ‡æ¢çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦å®ç°è¿™ä¸ªæ¥å£ã€‚å› ä¸ºå¤§éƒ¨åˆ†æ—¶å€™æˆ‘ä»¬å…¶å®ä¸éœ€è¦è‡ªå·±æ¥å®ç°è¿™ä¸ªæ¥å£ï¼Œå› æ­¤åœ¨è¿™ç¯‡å…¥é—¨ä¸­å°±ä¸å±•å¼€è¯´æ˜äº†ï¼Œæœ‰å…´è¶£çš„ç«¥é‹å¯ä»¥è‡ªè¡Œé’»ç ”ã€‚</p>

<p>è¿˜æœ‰å°±æ˜¯ä¸Šé¢æåˆ°è¿‡çš„UIViewControllerTransitioningDelegateä¸­çš„è¿”å›Interactiveå®ç°å¯¹è±¡çš„æ–¹æ³•ï¼Œæˆ‘ä»¬åŒæ ·ä¼šåœ¨äº¤äº’å¼åˆ‡æ¢ä¸­ç”¨åˆ°å®ƒä»¬ã€‚</p>

<h3 id="ç»§ç»­demo">ç»§ç»­Demo</h3>

<p>Demo time againã€‚åœ¨åˆšæ‰demoçš„åŸºç¡€ä¸Šï¼Œè¿™æ¬¡æˆ‘ä»¬ç”¨ä¸€ä¸ªå‘ä¸Šåˆ’åŠ¨çš„æ‰‹åŠ¿æ¥å§ä¹‹å‰å‘ˆç°çš„ModalViewControllerç»™dismissæ‰ï½å½“ç„¶æ˜¯äº¤äº’å¼çš„åˆ‡æ¢ï¼Œå¯ä»¥åŠé€”å–æ¶ˆçš„é‚£ç§ã€‚</p>

<p>é¦–å…ˆæ–°å»ºä¸€ä¸ªç±»ï¼Œç»§æ‰¿è‡ªUIPercentDrivenInteractiveTransitionï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥çœä¸å°‘äº‹å„¿ã€‚</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//SwipeUpInteractiveTransition.h</span>
<span class="k">@interface</span> <span class="nc">SwipeUpInteractiveTransition</span> <span class="p">:</span> <span class="nc">UIPercentDrivenInteractiveTransition</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">)</span> <span class="n">BOOL</span> <span class="n">interacting</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">wireToViewController</span><span class="p">:(</span><span class="n">UIViewController</span><span class="o">*</span><span class="p">)</span><span class="nv">viewController</span><span class="p">;</span>

<span class="k">@end</span>

<span class="c1">//SwipeUpInteractiveTransition.m</span>
<span class="k">@interface</span> <span class="nc">SwipeUpInteractiveTransition</span><span class="p">()</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">)</span> <span class="n">BOOL</span> <span class="n">shouldComplete</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">UIViewController</span> <span class="o">*</span><span class="n">presentingVC</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">SwipeUpInteractiveTransition</span>
<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">wireToViewController</span><span class="p">:(</span><span class="n">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">viewController</span>
<span class="p">{</span>
    <span class="n">self</span><span class="p">.</span><span class="n">presentingVC</span> <span class="o">=</span> <span class="n">viewController</span><span class="p">;</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">prepareGestureRecognizerInView</span><span class="p">:</span><span class="n">viewController</span><span class="p">.</span><span class="n">view</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">prepareGestureRecognizerInView</span><span class="p">:(</span><span class="n">UIView</span><span class="o">*</span><span class="p">)</span><span class="nv">view</span> <span class="p">{</span>
    <span class="n">UIPanGestureRecognizer</span> <span class="o">*</span><span class="n">gesture</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIPanGestureRecognizer</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithTarget</span><span class="p">:</span><span class="n">self</span> <span class="nf">action</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">handleGesture</span><span class="o">:</span><span class="p">)];</span>
    <span class="p">[</span><span class="n">view</span> <span class="nf">addGestureRecognizer</span><span class="p">:</span><span class="n">gesture</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="n">completionSpeed</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">percentComplete</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">handleGesture</span><span class="p">:(</span><span class="n">UIPanGestureRecognizer</span> <span class="o">*</span><span class="p">)</span><span class="nv">gestureRecognizer</span> <span class="p">{</span>
    <span class="n">CGPoint</span> <span class="n">translation</span> <span class="o">=</span> <span class="p">[</span><span class="n">gestureRecognizer</span> <span class="nf">translationInView</span><span class="p">:</span><span class="n">gestureRecognizer</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">superview</span><span class="p">];</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">gestureRecognizer</span><span class="p">.</span><span class="n">state</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">UIGestureRecognizerStateBegan</span><span class="p">:</span>
            <span class="c1">// 1. Mark the interacting flag. Used when supplying it in delegate.</span>
            <span class="n">self</span><span class="p">.</span><span class="n">interacting</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span>
            <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">presentingVC</span> <span class="nf">dismissViewControllerAnimated</span><span class="p">:</span><span class="nb">YES</span> <span class="nf">completion</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">UIGestureRecognizerStateChanged</span><span class="p">:</span> <span class="p">{</span>
            <span class="c1">// 2. Calculate the percentage of guesture</span>
            <span class="n">CGFloat</span> <span class="n">fraction</span> <span class="o">=</span> <span class="n">translation</span><span class="p">.</span><span class="n">y</span> <span class="o">/</span> <span class="mi">400</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
            <span class="c1">//Limit it between 0 and 1</span>
            <span class="n">fraction</span> <span class="o">=</span> <span class="n">fminf</span><span class="p">(</span><span class="n">fmaxf</span><span class="p">(</span><span class="n">fraction</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
            <span class="n">self</span><span class="p">.</span><span class="n">shouldComplete</span> <span class="o">=</span> <span class="p">(</span><span class="n">fraction</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">);</span>

            <span class="p">[</span><span class="n">self</span> <span class="nf">updateInteractiveTransition</span><span class="p">:</span><span class="n">fraction</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">case</span> <span class="n">UIGestureRecognizerStateEnded</span><span class="p">:</span>
        <span class="k">case</span> <span class="n">UIGestureRecognizerStateCancelled</span><span class="p">:</span> <span class="p">{</span>
            <span class="c1">// 3. Gesture over. Check if the transition should happen or not</span>
            <span class="n">self</span><span class="p">.</span><span class="n">interacting</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">self</span><span class="p">.</span><span class="n">shouldComplete</span> <span class="o">||</span> <span class="n">gestureRecognizer</span><span class="p">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">UIGestureRecognizerStateCancelled</span><span class="p">)</span> <span class="p">{</span>
                <span class="p">[</span><span class="n">self</span> <span class="nf">cancelInteractiveTransition</span><span class="p">];</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="p">[</span><span class="n">self</span> <span class="nf">finishInteractiveTransition</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nl">default:</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">@end</span>

</code></pre></div></div>

<p>æœ‰ç‚¹é•¿ï¼Œä½†æ˜¯åšçš„äº‹æƒ…è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚</p>

<ol>
  <li>æˆ‘ä»¬è®¾å®šäº†ä¸€ä¸ªBOOLå˜é‡æ¥è¡¨ç¤ºæ˜¯å¦å¤„äºåˆ‡æ¢è¿‡ç¨‹ä¸­ã€‚è¿™ä¸ªå¸ƒå°”å€¼å°†åœ¨ç›‘æµ‹åˆ°æ‰‹åŠ¿å¼€å§‹æ—¶è¢«è®¾ç½®ï¼Œæˆ‘ä»¬ä¹‹åä¼šåœ¨è°ƒç”¨è¿”å›è¿™ä¸ªInteractiveTransitionçš„æ—¶å€™ç”¨åˆ°ã€‚</li>
  <li>è®¡ç®—ç™¾åˆ†æ¯”ï¼Œæˆ‘ä»¬è®¾å®šäº†å‘ä¸‹åˆ’åŠ¨400åƒç´ æˆ–ä»¥ä¸Šä¸º100%ï¼Œæ¯æ¬¡æ‰‹åŠ¿çŠ¶æ€å˜åŒ–æ—¶æ ¹æ®å½“å‰æ‰‹åŠ¿ä½ç½®è®¡ç®—æ–°çš„ç™¾åˆ†æ¯”ï¼Œç»“æœè¢«é™åˆ¶åœ¨0ï½1ä¹‹é—´ã€‚ç„¶åæ›´æ–°InteractiveTransitionçš„ç™¾åˆ†æ•°ã€‚</li>
  <li>æ‰‹åŠ¿ç»“æŸæ—¶ï¼ŒæŠŠæ­£åœ¨åˆ‡æ¢çš„æ ‡è®¾ç½®å›NOï¼Œç„¶åè¿›è¡Œåˆ¤æ–­ã€‚åœ¨2ä¸­æˆ‘ä»¬è®¾å®šäº†æ‰‹åŠ¿è·ç¦»è¶…è¿‡è®¾å®šä¸€åŠå°±è®¤ä¸ºåº”è¯¥ç»“æŸæ‰‹åŠ¿ï¼Œå¦åˆ™å°±åº”è¯¥è¿”å›åŸæ¥çŠ¶æ€ã€‚åœ¨è¿™é‡Œä½¿ç”¨å…¶è¿›è¡Œåˆ¤æ–­ï¼Œå·²å†³å®šè¿™æ¬¡transitionæ˜¯å¦åº”è¯¥ç»“æŸã€‚</li>
</ol>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªå‘ä¸‹ç§»åŠ¨çš„UIViewåŠ¨ç”»ï¼Œç”¨æ¥è¡¨ç°dismissã€‚è¿™ä¸ªååˆ†ç®€å•ï¼Œå’ŒBouncePresentAnimationå¾ˆç›¸ä¼¼ï¼Œå†™ä¸€ä¸ªNormalDismissAnimationçš„å®ç°äº†UIViewControllerAnimatedTransitioningæ¥å£çš„ç±»å°±å¯ä»¥äº†ï¼Œæœ¬æ–‡é‡Œç•¥è¿‡ä¸å†™äº†ï¼Œæ„Ÿå…´è¶£çš„ç«¥é‹å¯ä»¥è‡ªè¡ŒæŸ¥çœ‹æºç ã€‚</p>

<p>æœ€åè°ƒæ•´MainViewControllerçš„å†…å®¹ï¼Œä¸»è¦ä¿®æ”¹ç‚¹æœ‰ä¸‰ä¸ªåœ°æ–¹ï¼š</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//MainViewController.m</span>
<span class="k">@interface</span> <span class="nc">MainViewController</span> <span class="p">()</span><span class="o">&lt;</span><span class="n">ModalViewControllerDelegate</span><span class="p">,</span><span class="n">UIViewControllerTransitioningDelegate</span><span class="o">&gt;</span>
<span class="c1">//...</span>
<span class="c1">// 1. Add dismiss animation and transition controller</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NormalDismissAnimation</span> <span class="o">*</span><span class="n">dismissAnimation</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">SwipeUpInteractiveTransition</span> <span class="o">*</span><span class="n">transitionController</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">MainViewController</span>

<span class="k">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="nf">initWithNibName</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">nibNameOrNil</span> <span class="nf">bundle</span><span class="p">:(</span><span class="n">NSBundle</span> <span class="o">*</span><span class="p">)</span><span class="nv">nibBundleOrNil</span>
<span class="p">{</span>
 	<span class="c1">//...</span>
        <span class="n">_dismissAnimation</span> <span class="o">=</span> <span class="p">[</span><span class="n">NormalDismissAnimation</span> <span class="nf">new</span><span class="p">];</span>
        <span class="n">_transitionController</span> <span class="o">=</span> <span class="p">[</span><span class="n">SwipeUpInteractiveTransition</span> <span class="nf">new</span><span class="p">];</span>
	<span class="c1">//...</span>
<span class="p">}</span>

<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">buttonClicked</span><span class="p">:(</span><span class="n">id</span><span class="p">)</span><span class="nv">sender</span>
<span class="p">{</span>
	<span class="c1">//...</span>
	<span class="c1">// 2. Bind current VC to transition controller.</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">transitionController</span> <span class="nf">wireToViewController</span><span class="p">:</span><span class="n">mvc</span><span class="p">];</span>
	<span class="c1">//...</span>
<span class="p">}</span>

<span class="c1">// 3. Implement the methods to supply proper objects.</span>
<span class="k">-</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">UIViewControllerAnimatedTransitioning</span><span class="o">&gt;</span><span class="p">)</span><span class="nf">animationControllerForDismissedController</span><span class="p">:(</span><span class="n">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">dismissed</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">dismissAnimation</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span><span class="p">(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">UIViewControllerInteractiveTransitioning</span><span class="o">&gt;</span><span class="p">)</span><span class="nf">interactionControllerForDismissal</span><span class="p">:(</span><span class="n">id</span><span class="o">&lt;</span><span class="n">UIViewControllerAnimatedTransitioning</span><span class="o">&gt;</span><span class="p">)</span><span class="nv">animator</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">transitionController</span><span class="p">.</span><span class="n">interacting</span> <span class="p">?</span> <span class="n">self</span><span class="p">.</span><span class="n">transitionController</span> <span class="p">:</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<ol>
  <li>åœ¨å…¶ä¸­æ·»åŠ dismissæ—¶å€™çš„åŠ¨ç”»å’Œäº¤äº’åˆ‡æ¢Controller</li>
  <li>åœ¨åˆå§‹åŒ–modalVCçš„æ—¶å€™ä¸ºäº¤äº’åˆ‡æ¢çš„Controllerç»‘å®šVC</li>
  <li>ä¸ºUIViewControllerTransitioningDelegateå®ç°dismissæ—¶å€™çš„å§”æ‰˜æ–¹æ³•ï¼ŒåŒ…æ‹¬è¿”å›å¯¹åº”çš„åŠ¨ç”»ä»¥åŠäº¤äº’åˆ‡æ¢Controller</li>
</ol>

<p>å®Œæˆäº†ï¼Œå¦‚æœå‘ä¸‹åˆ’åŠ¨æ—¶ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p>

<p><img src="/assets/images/2013/custom-vc-transition-2.gif" alt="äº¤äº’é©±åŠ¨çš„VCè½¬ç§»" /></p>

<h3 id="å…³äºios-7ä¸­è‡ªå®šä¹‰vcåˆ‡æ¢çš„ä¸€äº›æ€»ç»“">å…³äºiOS 7ä¸­è‡ªå®šä¹‰VCåˆ‡æ¢çš„ä¸€äº›æ€»ç»“</h3>

<p>demoä¸­åªå±•ç¤ºäº†å¯¹äºmodalVCçš„presentå’Œdismissçš„è‡ªå®šä¹‰åˆ‡æ¢æ•ˆæœï¼Œå½“ç„¶å¯¹ä¸Navigation Controllerçš„Pushå’ŒPopåˆ‡æ¢ä¹Ÿæ˜¯æœ‰ç›¸åº”çš„ä¸€å¥—æ–¹æ³•çš„ã€‚å®ç°èµ·æ¥å’Œdismissååˆ†ç±»ä¼¼ï¼Œåªä¸è¿‡å¯¹åº”UIViewControllerTransitioningDelegateçš„è¯¢é—®åŠ¨ç”»å’Œäº¤äº’çš„æ–¹æ³•æ¢åˆ°äº†UINavigationControllerDelegateä¸­ï¼ˆä¸ºäº†åŒºåˆ«pushæˆ–è€…popï¼Œçœ‹ä¸€ä¸‹è¿™ä¸ªæ¥å£åº”è¯¥èƒ½é©¬ä¸ŠçŸ¥é“ï¼‰ã€‚å¦å¤–ä¸€ä¸ªå¾ˆå¥½çš„ç¦åˆ©æ˜¯ï¼Œå¯¹äºæ ‡å‡†çš„navControllerçš„Popæ“ä½œï¼Œè‹¹æœå·²ç»æ›¿æˆ‘ä»¬å®ç°äº†æ‰‹åŠ¿é©±åŠ¨è¿”å›ï¼Œæˆ‘ä»¬ä¸ç”¨å†è´¹å¿ƒæ¯ä¸ªå»å®ç°ä¸€éäº†ï¼Œcheersï½</p>

<p>å¦å¤–ï¼Œå¯èƒ½ä½ ä¼šè§‰å¾—ä½¿ç”¨VCå®¹å™¨å…¶æä¾›çš„transitionåŠ¨ç”»æ–¹æ³•æ¥è¿›è¡ŒVCåˆ‡æ¢å°±å·²ç»å¤Ÿå¥½å¤Ÿæ–¹ä¾¿äº†ï¼Œä¸ºä»€ä¹ˆiOS7ä¸­è¿˜è¦å¼•å…¥ä¸€å¥—è‡ªå®šä¹‰çš„æ–¹å¼å‘¢ã€‚å…¶å®ä»æ ¹æœ¬æ¥è¯´å®ƒä»¬æ‰€æ‰¿æ‹…çš„æ˜¯ä¸¤ç±»å®Œå…¨ä¸åŒçš„ä»»åŠ¡ï¼šè‡ªå®šä¹‰VCå®¹å™¨å¯ä»¥æä¾›è‡ªå·±å®šä¹‰çš„VCç»“æ„ï¼Œå¹¶ä¿è¯ç³»ç»Ÿçš„å„ç±»æ–¹æ³•å’Œé€šçŸ¥èƒ½å¤Ÿå‡†ç¡®ä¼ é€’åˆ°åˆé€‚çš„VCï¼Œå®ƒæä¾›çš„transitionæ–¹æ³•è™½ç„¶å¯ä»¥å®ç°ä¸€äº›ç®€å•çš„UIViewåŠ¨ç”»ï¼Œä½†æ˜¯éš¾ä»¥é‡ç”¨ï¼Œå¯ä»¥è¯´æ˜¯å’ŒcontainerVCå®Œå…¨è€¦åˆåœ¨ä¸€èµ·çš„ï¼›è€Œè‡ªå®šä¹‰åˆ‡æ¢å¹¶ä¸æ”¹å˜VCçš„ç»„ç»‡ç»“æ„ï¼Œåªæ˜¯è´Ÿè´£æä¾›viewçš„æ•ˆæœï¼Œå› ä¸ºVCåˆ‡æ¢å°†åŠ¨ç”»éƒ¨åˆ†ã€åŠ¨ç”»é©±åŠ¨éƒ¨åˆ†éƒ½ä½¿ç”¨æ¥å£çš„æ–¹å¼ç»™å‡ºï¼Œå› æ­¤é‡ç”¨æ€§éå¸¸ä¼˜ç§€ã€‚åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç²¾å¿ƒç¼–å†™çš„ä¸€å¥—UIViewåŠ¨ç”»æ˜¯å¯ä»¥è½»æ˜“åœ°ç”¨åœ¨ä¸åŒçš„VCä¸­ï¼Œç”šè‡³æ˜¯ä¸åŒçš„é¡¹ç›®ä¸­çš„ã€‚</p>

<p>éœ€è¦ç‰¹åˆ«ä¸€æçš„æ˜¯ï¼ŒGithubä¸Šçš„<a href="https://github.com/ColinEberhardt/VCTransitionsLibrary">ColinEberhardtçš„VCTransitionsLibrary</a>å·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç³»åˆ—çš„VCè‡ªå®šä¹‰åˆ‡æ¢åŠ¨ç”»æ•ˆæœï¼Œæ­£æ˜¯å¾—ç›ŠäºiOS7ä¸­è¿™ä¸€å—çš„è‰¯å¥½è®¾è®¡ï¼ˆè™½ç„¶è¿™å‡ ä¸ªæ¥å£çš„å‘½åæ¯”è¾ƒç›¸ä¼¼ï¼Œåœ¨å¼„æ˜ç™½ä¹‹å‰ä¼šæœ‰äº›confusingï¼‰ï¼Œå› æ­¤è¿™äº›æ•ˆæœä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œç›¸ä¿¡ä¸€èˆ¬é¡¹ç›®ä¸­æ˜¯è¶³å¤Ÿä½¿ç”¨çš„äº†ã€‚è€Œå…¶ä»–æ›´å¤æ‚æˆ–è€…ç‚«ç›®çš„æ•ˆæœï¼Œäº¦å¯åœ¨å…¶åŸºç¡€ä¸Šè¿›è¡Œæ‰©å±•æ”¹è¿›å¾—åˆ°ã€‚å¯ä»¥è¯´éšç€è¶Šæ¥è¶Šå¤šçš„åº”ç”¨è½¬å‘iOS7ï¼Œè‡ªå®šä¹‰VCåˆ‡æ¢å°†æˆä¸ºæ–°çš„ç”¨æˆ·äº¤äº’å®ç°çš„åŸºç¡€å’Œé‡è¦éƒ¨åˆ†ï¼Œå¯¹äºä»Šåä¼šåœ¨å…¶åŸºç¡€ä¸Šä¼šè¡ç”Ÿå‡ºæ€æ ·è®©äººçœ¼å‰ä¸€äº®çš„äº¤äº’è®¾è®¡ï¼Œä¸å¦¨è®©æˆ‘ä»¬æ‹­ç›®ä»¥å¾…ï¼ˆæˆ–è€…è‡ªå·±åŠªåŠ›å»åˆ›é€ ï¼‰ã€‚</p>
:ET