I"Åã<blockquote>
  <p>å†™åœ¨å‰é¢ï¼š<a href="https://objccn.io">ObjC ä¸­å›½</a> (æˆ–è€…è¯´æˆ‘ä¸ªäºº) ç°åœ¨æ­£å’Œ objc.io åˆä½œæ‰“é€ ä¸€æœ¬å…³äº <a href="https://www.objc.io/books/app-architecture/">app æ¶æ„</a>çš„ä¹¦ç±ã€‚è‹±æ–‡ç‰ˆæœ¬å·²ç»æå‰é¢„å”®ï¼Œä¹¦æœ¬èº«ä¹Ÿè¿›å…¥äº†æœ€åçš„ review é˜¶æ®µã€‚æˆ‘ä»¬ä¹Ÿå°†åœ¨ç¬¬ä¸€æ—¶é—´è¿›è¡Œæœ¬ä¹¦ä¸­æ–‡ç‰ˆçš„å·¥ä½œï¼Œè¿˜è¯·å¤§å®¶å…³æ³¨ã€‚</p>

  <p>æœ¬æ–‡çš„å†…å®¹ä¹Ÿæ˜¯æœ‰å…³ app æ¶æ„çš„ä¸€äº›æ€è€ƒï¼Œå¦‚æœä½ å¯¹æ¶æ„æ–¹é¢çš„è¯é¢˜æœ‰å…´è¶£çš„è¯ï¼Œæˆ‘ä¹‹å‰è¿˜å†™è¿‡ä¸€ç¯‡åˆ©ç”¨ reducer çš„<a href="https://onevcat.com/2017/07/state-based-viewcontroller/">å•å‘æ•°æ®æµåŠ¨çš„å‡½æ•°å¼ View Controller</a> çš„æ–‡ç« å¯ä¾›å‚è€ƒã€‚</p>
</blockquote>

<p>å¦‚ä½•é¿å…æŠŠ Model View Controller å†™æˆ Massive View Controller å·²ç»æ˜¯è€ç”Ÿå¸¸è°ˆçš„é—®é¢˜äº†ã€‚ä¸ç®¡æ˜¯æ‹†åˆ† View Controller çš„åŠŸèƒ½ (ä½¿ç”¨å¤šä¸ª Child View Controller)ï¼Œè¿˜æ˜¯æ¢ç”¨â€œå¹¿ä¹‰â€çš„ MVC æ¡†æ¶ (æ¯”å¦‚ MVVM æˆ–è€… VIPER)ï¼Œåˆæˆ–è€…æ›´æ¿€è¿›ä¸€ç‚¹ï¼Œè½¬æ¢æ€è·¯ä½¿ç”¨ Reactive æ¨¡å¼æˆ– Reducer æ¨¡å¼ï¼Œå…¶å®æ‰€æƒ³è¦è§£å†³çš„é—®é¢˜æœ¬è´¨åœ¨äºï¼Œæˆ‘ä»¬è¦å¦‚ä½•æ‰èƒ½æ›´æ¸…æ™°åœ°ç®¡ç†â€œç”¨æˆ·æ“ä½œï¼Œæ¨¡å‹å˜æ›´ï¼ŒUI åé¦ˆâ€è¿™ä¸€æ•°æ®æµåŠ¨çš„æ–¹å¼ã€‚</p>

<p>éä¼ ç»Ÿçš„ MVC å¯ä»¥å¸®åŠ©æˆ‘ä»¬éµå¾ªä¸€äº›æ›´ä¸å®¹æ˜“çŠ¯é”™çš„ç¼–ç¨‹èŒƒå¼ (è¿™ä¸€ç‚¹å’Œ Java å¾ˆåƒï¼Œä½¿ç”¨å†—æ‚çš„ pattern æ¥è§„èŒƒå¼€å‘ï¼Œè®©æ–°äººä¹Ÿèƒ½å†™å‡ºâ€œæˆç†Ÿâ€çš„ä»£ç )ï¼Œä½†æ˜¯å¦‚æœä¸ä»æ ¹æœ¬ä¸Šç†è§£æ•°æ®æµåŠ¨åœ¨ MVC ä¸­çš„è§’è‰²ï¼Œé‚£ä¸è¿‡å°±æ˜¯æœ«å­¦è‚¤å—ï¼Œè¿Ÿæ—©ä¼šå‡ºç°é—®é¢˜ã€‚</p>

<h3 id="ä¾‹å­">ä¾‹å­</h3>

<p>ä¸¾ä¸€ä¸ªéå¸¸ç®€å•çš„ View Controller çš„ä¾‹å­ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª Table View Controller æ¥è®°å½• To Do åˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç‚¹å‡»å¯¼èˆªæ çš„åŠ å·æŒ‰é’®æ¥è¿½åŠ ä¸€ä¸ªæ¡ç›®ï¼Œç”¨ Swipe cell çš„æ–¹å¼åˆ é™¤æ¡ç›®ã€‚æˆ‘ä»¬å¸Œæœ›æœ€å¤šåŒæ—¶åªèƒ½å­˜åœ¨ 10 æ¡å¾…åŠé¡¹ç›®ã€‚è¿™ä¸ª View Controller çš„ä»£ç éå¸¸ç®€å•ï¼Œå¯èƒ½ä¹Ÿæ˜¯å¾ˆå¤šå¼€å‘è€…æ¯å¤©ä¼šå†™çš„ä»£ç ã€‚åŒ…æ‹¬è®¾ç½® Playground å’Œæ·»åŠ æŒ‰é’®ç­‰ç­‰ï¼Œä¸€å…±ä¹Ÿå°± 60 è¡Œã€‚æˆ‘å°†å®ƒæ”¾åˆ°äº†<a href="https://gist.github.com/onevcat/4042d4d0f156b986e4755a7d4370bb9c">è¿™ä¸ª gist ä¸­</a>ï¼Œä½ å¯ä»¥å…¨éƒ¨å¤åˆ¶ä¸‹æ¥æ‰”åˆ° Playground é‡ŒæŸ¥çœ‹æ•ˆæœã€‚</p>

<p>è¿™é‡Œç®€å•å¯¹æ¯”è¾ƒå…³é”®çš„ä»£ç è¿›è¡Œä¸€äº›è§£é‡Šã€‚é¦–å…ˆæ˜¯æ¨¡å‹å®šä¹‰ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// å®šä¹‰ç®€å•çš„ ToDo Model</span>
<span class="kd">struct</span> <span class="kt">ToDoItem</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">UUID</span>
    <span class="k">let</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="kt">UUID</span><span class="p">()</span>
        <span class="k">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ç„¶åæˆ‘ä»¬ä½¿ç”¨ <code class="highlighter-rouge">UITableViewController</code> çš„å­ç±»è¿›è¡Œå¾…åŠäº‹é¡¹çš„å±•ç¤ºå’Œæ·»åŠ ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">ToDoListViewController</span><span class="p">:</span> <span class="kt">UITableViewController</span> <span class="p">{</span>
    <span class="c1">// ä¿å­˜å½“å‰å¾…åŠäº‹é¡¹</span>
    <span class="k">var</span> <span class="nv">items</span><span class="p">:</span> <span class="p">[</span><span class="kt">ToDoItem</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1">// ç‚¹å‡»æ·»åŠ æŒ‰é’®</span>
    <span class="kd">@objc</span> <span class="kd">func</span> <span class="nf">addButtonPressed</span><span class="p">(</span><span class="n">_</span> <span class="nv">sender</span><span class="p">:</span> <span class="kt">Any</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">newCount</span> <span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">let</span> <span class="nv">title</span> <span class="o">=</span> <span class="s">"ToDo Item </span><span class="se">\(</span><span class="n">newCount</span><span class="se">)</span><span class="s">"</span>
        
        <span class="c1">// æ›´æ–° `items`</span>
        <span class="n">items</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="n">title</span><span class="p">))</span>
        
        <span class="c1">// ä¸º table view æ·»åŠ æ–°è¡Œ</span>
        <span class="k">let</span> <span class="nv">indexPath</span> <span class="o">=</span> <span class="kt">IndexPath</span><span class="p">(</span><span class="nv">row</span><span class="p">:</span> <span class="n">newCount</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">section</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">tableView</span><span class="o">.</span><span class="nf">insertRows</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="p">[</span><span class="n">indexPath</span><span class="p">],</span> <span class="nv">with</span><span class="p">:</span> <span class="o">.</span><span class="n">automatic</span><span class="p">)</span>
        
        <span class="c1">// ç¡®å®šæ˜¯å¦è¾¾åˆ°åˆ—è¡¨ä¸Šé™ï¼Œå¦‚æœè¾¾åˆ°ï¼Œç¦ç”¨ addButton</span>
        <span class="k">if</span> <span class="n">newCount</span> <span class="o">&gt;=</span> <span class="mi">10</span> <span class="p">{</span>
            <span class="n">addButton</span><span class="p">?</span><span class="o">.</span><span class="n">isEnabled</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æ¥ä¸‹æ¥ï¼Œå¤„ç† table view çš„å±•ç¤ºï¼Œè¿™éƒ¨åˆ†å†…å®¹ä¹å–„å¯é™ˆï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">ToDoListViewController</span> <span class="p">{</span>
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">numberOfRowsInSection</span> <span class="nv">section</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">items</span><span class="o">.</span><span class="n">count</span>
    <span class="p">}</span>
    
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">cellForRowAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UITableViewCell</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">cell</span> <span class="o">=</span> <span class="n">tableView</span><span class="o">.</span><span class="nf">dequeueReusableCell</span><span class="p">(</span><span class="nv">withIdentifier</span><span class="p">:</span> <span class="n">cellIdentifier</span><span class="p">,</span> <span class="nv">for</span><span class="p">:</span> <span class="n">indexPath</span><span class="p">)</span>
        <span class="n">cell</span><span class="o">.</span><span class="n">textLabel</span><span class="p">?</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="n">indexPath</span><span class="o">.</span><span class="n">row</span><span class="p">]</span><span class="o">.</span><span class="n">title</span>
        <span class="k">return</span> <span class="n">cell</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æœ€åï¼Œå®ç°æ»‘åŠ¨ cell åˆ é™¤çš„åŠŸèƒ½ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">ToDoListViewController</span> <span class="p">{</span>
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">trailingSwipeActionsConfigurationForRowAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UISwipeActionsConfiguration</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">deleteAction</span> <span class="o">=</span> <span class="kt">UIContextualAction</span><span class="p">(</span><span class="nv">style</span><span class="p">:</span> <span class="o">.</span><span class="n">destructive</span><span class="p">,</span> <span class="nv">title</span><span class="p">:</span> <span class="s">"Delete"</span><span class="p">)</span> <span class="p">{</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">done</span> <span class="k">in</span>
            <span class="c1">// ç”¨æˆ·ç¡®è®¤åˆ é™¤ï¼Œä» `items` ä¸­ç§»é™¤è¯¥äº‹é¡¹</span>
            <span class="k">self</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="nf">remove</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="n">indexPath</span><span class="o">.</span><span class="n">row</span><span class="p">)</span>
            <span class="c1">// ä» table view ä¸­ç§»é™¤å¯¹åº”è¡Œ</span>
            <span class="k">self</span><span class="o">.</span><span class="n">tableView</span><span class="o">.</span><span class="nf">deleteRows</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="p">[</span><span class="n">indexPath</span><span class="p">],</span> <span class="nv">with</span><span class="p">:</span> <span class="o">.</span><span class="n">automatic</span><span class="p">)</span>
            <span class="c1">// ç»´æŠ¤ addButton çŠ¶æ€</span>
            <span class="k">if</span> <span class="k">self</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">count</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">addButton</span><span class="p">?</span><span class="o">.</span><span class="n">isEnabled</span> <span class="o">=</span> <span class="kc">true</span>
            <span class="p">}</span>
            <span class="nf">done</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kt">UISwipeActionsConfiguration</span><span class="p">(</span><span class="nv">actions</span><span class="p">:</span> <span class="p">[</span><span class="n">deleteAction</span><span class="p">])</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>

<p><img src="/assets/images/2018/todo-demo.gif" alt="" /></p>

<p>çœ‹èµ·æ¥ä¸€åˆ‡æ­£å¸¸å·¥ä½œï¼ä¸è¿‡ï¼Œä½ èƒ½çœ‹å‡ºæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼ŸæŠ‘æˆ–è¯´ä½ è§‰å¾—è¿™æ®µä»£ç å·²ç»å®Œç¾æ— ç‘•äº†ï¼Ÿ</p>

<h3 id="é£é™©">é£é™©</h3>

<p>ç®€å•æ¥è¯´ï¼Œè¿™ä¹Ÿå·²ç»æ˜¯å¯¹ MVC çš„è¯¯ç”¨äº†ã€‚ä¸Šé¢çš„ä»£ç å­˜åœ¨ç€è¿™äº›æ½œåœ¨é—®é¢˜ï¼š</p>

<ol>
  <li>
    <p>Model å±‚â€œå¯„ç”Ÿâ€åœ¨ViewController ä¸­</p>

    <p>åœ¨è¿™æ®µä»£ç ä¸­ï¼ŒView Controller é‡Œçš„ <code class="highlighter-rouge">items</code> å……å½“äº† modelã€‚</p>

    <p>è¿™å¯¼è‡´äº†å‡ ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬éš¾ä»¥ä»å¤–ç•Œç»´æŠ¤æˆ–è€…åŒæ­¥ <code class="highlighter-rouge">items</code> çš„çŠ¶æ€ï¼Œæ·»åŠ å’Œåˆ é™¤æ“ä½œè¢«â€œç»‘å®šâ€åœ¨äº†è¿™ä¸ª View Controller é‡Œï¼Œå¦‚æœä½ è¿˜æƒ³é€šè¿‡å…¶ä»– View Controller ç»´æŠ¤å¾…åŠåˆ—è¡¨çš„è¯ï¼Œå°±ä¸å¾—ä¸è€ƒè™‘æ•°æ®åŒæ­¥çš„é—®é¢˜ (æˆ‘ä»¬ä¼šåœ¨ç¨åçœ‹åˆ°å‡ ä¸ªå…·ä½“çš„è¿™æ–¹é¢çš„ä¾‹å­)ï¼›å¦å¤–ï¼Œè¿™æ ·çš„è®¾ç½®å¯¼è‡´ <code class="highlighter-rouge">items</code> éš¾ä»¥æµ‹è¯•ã€‚ä½ å‡ ä¹æ— æ³•ä¸ºæ·»åŠ /åˆ é™¤/ä¿®æ”¹å¾…åŠåˆ—è¡¨è¿›è¡Œ Model å±‚çš„æµ‹è¯•ã€‚</p>
  </li>
  <li>
    <p>è¿åæ•°æ®æµåŠ¨è§„åˆ™å’Œå•ä¸€èŒè´£è§„åˆ™</p>

    <p>å¦‚æœæˆ‘ä»¬ä»”ç»†æ€è€ƒï¼Œä¼šå‘ç°ï¼Œç”¨æˆ·ç‚¹å‡»æ·»åŠ æŒ‰é’®ï¼Œæˆ–è€…ä¾§æ»‘åˆ é™¤ cell æ—¶ï¼Œåœ¨ View Controller ä¸­å…¶å®å‘ç”Ÿäº†è¿™äº›äº‹æƒ…ï¼š</p>

    <ol>
      <li>ç»´æŠ¤ Model (ä¹Ÿå°±æ˜¯ <code class="highlighter-rouge">items</code>)</li>
      <li>å¢åˆ  table view çš„ cell</li>
      <li>ç»´æŠ¤ <code class="highlighter-rouge">addButton</code> çš„å¯ç”¨çŠ¶æ€</li>
    </ol>

    <p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒUI æ“ä½œä¸ä»…å¯¼è‡´äº† Model çš„å˜æ›´ï¼Œè¿˜åŒæ—¶å¯¼è‡´äº† UI çš„å˜åŒ–ã€‚ç†æƒ³åŒ–çš„æ•°æ®æµåŠ¨åº”è¯¥æ˜¯å•å‘çš„ï¼šUI æ“ä½œ -&gt; ç»ç”± View Controller è¿›è¡Œæ¨¡å‹æ›´æ–° -&gt; æ–°çš„æ¨¡å‹ç»ç”± View Controller æ›´æ–° UI -&gt; ç­‰å¾…æ–°çš„ UI æ“ä½œï¼Œè€Œåœ¨ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å˜æˆäº†â€œç»ç”± View Controller è¿›è¡Œæ¨¡å‹æ›´æ–°ä»¥åŠ UI æ“ä½œâ€ã€‚è™½ç„¶çœ‹èµ·æ¥è¿™æ˜¯å¾ˆä¸èµ·çœ¼çš„å˜æ›´ï¼Œä½†æ˜¯ä¼šåœ¨é¡¹ç›®å¤æ‚åå¸¦æ¥éº»çƒ¦ã€‚</p>
  </li>
</ol>

<p>ä¹Ÿè®¸ä½ ç°åœ¨å¹¶ä¸è§‰å¾—æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œè®©æˆ‘ä»¬æ¥å‡è®¾ä¸€äº›æƒ…æ™¯ï¼Œä½ å¯ä»¥æ€è€ƒä¸€ä¸‹å¦‚ä½•å®ç°å§ã€‚</p>

<h4 id="åœºæ™¯ä¸€">åœºæ™¯ä¸€</h4>

<p>é¦–å…ˆæ¥çœ‹çœ‹å¾…åŠæ¡ç›®çš„ç¼–è¾‘ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ä¸€ä¸ªè¯¦æƒ…é¡µé¢ï¼Œç”¨æ¥ç¼–è¾‘æŸä¸ªå¾…åŠçš„ç»†èŠ‚ï¼Œæ¯”å¦‚ä¸º <code class="highlighter-rouge">ToDoItem</code> æ·»åŠ ä¸Š <code class="highlighter-rouge">date</code>ï¼Œ<code class="highlighter-rouge">location</code> å’Œ <code class="highlighter-rouge">detail</code> è¿™ç±»çš„å±æ€§ã€‚å¦å¤–ï¼ŒPM å’Œç”¨æˆ·ä¹Ÿè®¸å¸Œæœ›åœ¨è¯¦æƒ…é¡µé¢ä¸­ä¹Ÿèƒ½ç›´æ¥åˆ é™¤è¿™ä¸ªæ­£åœ¨ç¼–è¾‘çš„å¾…åŠã€‚</p>

<p>ä»¥ç°åœ¨çš„å®ç°æ¥çœ‹ï¼Œä¸€ä¸ªå¾ˆæœ´ç´ çš„æƒ³æ³•æ˜¯æ–°å»º <code class="highlighter-rouge">ToDoEditViewController</code>ï¼Œç„¶åè®¾ç½® <code class="highlighter-rouge">delegate</code> æ¥å‘Šè¯‰ <code class="highlighter-rouge">ToDoListViewController</code> æŸä¸ª <code class="highlighter-rouge">ToDoItem</code> å‘ç”Ÿäº†å˜åŒ–ï¼Œç„¶ååœ¨ <code class="highlighter-rouge">ToDoListViewController</code> è¿›è¡Œå¯¹ <code class="highlighter-rouge">items</code> è¿›è¡Œæ“ä½œï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">ToDoEditViewControllerDelegate</span><span class="p">:</span> <span class="kd">class</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">editViewController</span><span class="p">(</span><span class="n">_</span> <span class="nv">viewController</span><span class="p">:</span> <span class="kt">ToDoEditViewController</span><span class="p">,</span> <span class="n">editToDoItem</span> <span class="nv">original</span><span class="p">:</span> <span class="kt">ToDoItem</span><span class="p">,</span> <span class="n">to</span> <span class="nv">new</span><span class="p">:</span> <span class="kt">ToDoItem</span><span class="p">)</span>
    <span class="kd">func</span> <span class="nf">editViewController</span><span class="p">(</span><span class="n">_</span> <span class="nv">viewController</span><span class="p">:</span> <span class="kt">ToDoEditViewController</span><span class="p">,</span> <span class="n">remove</span> <span class="nv">item</span><span class="p">:</span> <span class="kt">ToDoItem</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// åœ¨ ToDoListViewController ä¸­</span>
<span class="kd">extension</span> <span class="kt">ToDoListViewController</span><span class="p">:</span> <span class="kt">ToDoEditViewControllerDelegate</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">editViewController</span><span class="p">(</span><span class="n">_</span> <span class="nv">viewController</span><span class="p">:</span> <span class="kt">ToDoEditViewController</span><span class="p">,</span> <span class="n">remove</span> <span class="nv">item</span><span class="p">:</span> <span class="kt">ToDoItem</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">index</span> <span class="o">=</span> <span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">index</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">item</span><span class="o">.</span><span class="n">id</span> <span class="p">})</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
        <span class="n">items</span><span class="o">.</span><span class="nf">remove</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">indexPath</span> <span class="o">=</span> <span class="kt">IndexPath</span><span class="p">(</span><span class="nv">row</span><span class="p">:</span> <span class="n">index</span><span class="p">,</span> <span class="nv">section</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">tableView</span><span class="o">.</span><span class="nf">deleteRows</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="p">[</span><span class="n">indexPath</span><span class="p">],</span> <span class="nv">with</span><span class="p">:</span> <span class="o">.</span><span class="n">automatic</span><span class="p">)</span>
        <span class="k">if</span> <span class="k">self</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">count</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">addButton</span><span class="p">?</span><span class="o">.</span><span class="n">isEnabled</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">editViewController</span><span class="p">(</span><span class="n">_</span> <span class="nv">viewController</span><span class="p">:</span> <span class="kt">ToDoEditViewController</span><span class="p">,</span> <span class="n">editToDoItem</span> <span class="nv">original</span><span class="p">:</span> <span class="kt">ToDoItem</span><span class="p">,</span> <span class="n">to</span> <span class="nv">new</span><span class="p">:</span> <span class="kt">ToDoItem</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//...</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æœ‰ä¸€éƒ¨åˆ†å’Œä¹‹å‰é‡å¤çš„ä»£ç ï¼Œè™½ç„¶å¯ä»¥é€šè¿‡å°†å®ƒä»¬æå–æˆåƒæ˜¯ <code class="highlighter-rouge">removeItem(at index: Int)</code> è¿™æ ·çš„æ–¹æ³•ï¼Œä½†æ˜¯å¹¶ä¸èƒ½æ”¹å˜éå•ä¸€åŠŸèƒ½çš„é—®é¢˜ã€‚<code class="highlighter-rouge">ToDoEditViewController</code> æœ¬èº«ä¹Ÿæ— æ³•å’Œ <code class="highlighter-rouge">items</code> é€šè®¯ï¼Œå› æ­¤å®ƒæ‰®æ¼”çš„è§’è‰²å‡ ä¹å°±æ˜¯ä¸€ä¸ªâ€œä¸“ç”¨â€çš„ Viewï¼Œä¸€æ—¦è„±ç¦»äº† <code class="highlighter-rouge">ToDoListViewController</code>ï¼Œåˆ™â€œéš¾å ªé‡ä»»â€ã€‚</p>

<h4 id="åœºæ™¯äºŒ">åœºæ™¯äºŒ</h4>

<p>å¦å¤–ï¼Œçº¯å•æœºçš„ app å·²ç»è·Ÿä¸ä¸Šæ—¶ä»£äº†ï¼Œä¸ç®¡æ˜¯ iCloud åŒæ­¥è¿˜æ˜¯è‡ªå»ºæœåŠ¡å™¨ï¼Œæˆ‘ä»¬æ€»æ˜¯æƒ³è¦ä¸€ä¸ªåç«¯æ¥ä¸ºç”¨æˆ·è·¨è®¾å¤‡ä¿å­˜åˆ—è¡¨ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å¯èƒ½çš„å¢å¼ºã€‚åœ¨ç°æœ‰æ¶æ„ä¸‹ï¼ŒæŠŠä»æœåŠ¡å™¨è·å–å·²æœ‰æ¡ç›®çš„é€»è¾‘æ”¾åˆ° <code class="highlighter-rouge">ToDoListViewController</code> ä¹Ÿæ˜¯å¾ˆè‡ªç„¶çš„æƒ³æ³•ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
    <span class="c1">//..</span>
    <span class="kt">NetworkService</span><span class="o">.</span><span class="nf">getExistingToDoItems</span><span class="p">()</span><span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">items</span> <span class="k">in</span> 
        <span class="k">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">items</span>
        <span class="k">self</span><span class="o">.</span><span class="n">tableView</span><span class="o">.</span><span class="nf">reloadData</span><span class="p">()</span>
        <span class="k">if</span> <span class="k">self</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">10</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">addButton</span><span class="p">?</span><span class="o">.</span><span class="n">isEnabled</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>è¿™ç§ç®€å•çš„å®ç°é¢ä¸´å¾ˆå¤šæŒ‘æˆ˜ï¼Œæ˜¯æˆ‘ä»¬åœ¨å®é™… app ä¸­ä¸å¾—ä¸è€ƒè™‘çš„ï¼š</p>

<ol>
  <li>æ˜¯ä¸æ˜¯åº”è¯¥éœ€è¦åœ¨ <code class="highlighter-rouge">getExistingToDoItems</code> è¿‡ç¨‹ä¸­ block æ‰ UIï¼Œå¦åˆ™ç”¨æˆ·åœ¨è¯·æ±‚å®Œæˆå‰æ‰€æ·»åŠ çš„æ¡ç›®å°†è¢«è¦†ç›–ã€‚</li>
  <li>åœ¨æ·»åŠ å’Œåˆ é™¤æ¡ç›®çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½éœ€è¦è¿›è¡Œç½‘ç»œè¯·æ±‚ï¼Œå¦å¤–æˆ‘ä»¬ä¹Ÿéœ€è¦æ ¹æ®è¯·æ±‚è¿”å›çš„çŠ¶æ€æ›´æ–°æ·»åŠ æŒ‰é’®çš„çŠ¶æ€ã€‚</li>
  <li>Block ç”¨æˆ·è¾“å…¥å°†è®© app å˜ä¸ºæ²¡ç½‘æ— æ³•ä½¿ç”¨ï¼Œä¸è¿›è¡Œ block çš„è¯åˆ™éœ€è¦è€ƒè™‘æ•°æ®åŒæ­¥çš„é—®é¢˜ã€‚</li>
  <li>å¦å¤–ï¼Œæˆ‘ä»¬éœ€ä¸éœ€è¦åœ¨æ²¡ç½‘æ—¶ä¾ç„¶è®©ç”¨æˆ·å¯ä»¥è¿›è¡Œå¢åŠ æˆ–åˆ é™¤ï¼Œå¹¶ç¼“å­˜æ“ä½œï¼Œç­‰åˆ°æœ‰ç½‘æ—¶å†å°†è¿™äº›ç¼“å­˜åæ˜ ç»™æœåŠ¡å™¨ã€‚</li>
  <li>å¦‚æœéœ€è¦å®ç° 4ï¼Œé‚£ä¹ˆè¿˜è¦è€ƒè™‘æ“ä½œç»“æœå¯¼è‡´è¶…å‡ºæ¡ç›®æœ€å¤§æ•°é‡é™åˆ¶çš„é”™è¯¯å¤„ç†ï¼Œä»¥åŠå¤šè®¾å¤‡é—´æ•°æ®å†²çªå¤„ç†çš„é—®é¢˜ã€‚</li>
</ol>

<p>æ˜¯ä¸æ˜¯çªç„¶æ„Ÿè§‰æœ‰äº›å¤´å¤§ï¼Ÿ</p>

<h3 id="æ”¹å–„">æ”¹å–„</h3>

<p>è¿™äº›é—®é¢˜çš„æ¥æºå…¶å®éƒ½æ˜¯æˆ‘ä»¬ä¸ºäº†â€œçœäº‹â€ï¼Œé€‰æ‹©äº†ä¸€ä¸ª<strong>ä¸é‚£ä¹ˆæœ‰æ•ˆçš„ Model</strong>ï¼Œä»¥åŠ<strong>å­˜åœ¨é£é™©çš„æ•°æ®æµåŠ¨æ–¹å¼</strong>ã€‚æˆ–è€…è¯´ï¼Œæˆ‘ä»¬æ²¡æœ‰æ­£ç¡®å’Œä¸¥æ ¼åœ°ä½¿ç”¨ MVC æ¶æ„ã€‚</p>

<p>å…³äº MVCï¼Œæ–¯å¦ç¦çš„ CS193p Paul è€å¸ˆæœ‰ä¸€å¼ éå¸¸ç»å…¸çš„å›¾ï¼Œç›¸ä¿¡å¾ˆå¤š iOS çš„å¼€å‘è€…ä¹Ÿéƒ½çœ‹è¿‡ï¼š</p>

<p><img src="/assets/images/2018/mvc.png" alt="" /></p>

<p>æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç­‰äºæŠŠ Model æ”¾åˆ°äº† Controller é‡Œï¼Œè€Œä¸” Model ä¹Ÿæ— æ³•ä¸ Controller è¿›è¡Œæœ‰æ•ˆçš„é€šè®¯ (å›¾ä¸­çš„ Notification &amp; KVO éƒ¨åˆ†)ã€‚è¿™å¯¼è‡´ Controller æ‰¿è½½äº†å¤ªå¤šçš„åŠŸèƒ½ï¼Œè¿™å¾€å¾€æ˜¯å…‰è£åœ°è¿ˆå‘ Massive View Controller çš„ç¬¬ä¸€æ­¥ã€‚</p>

<h4 id="å•ç‹¬çš„-model">å•ç‹¬çš„ Model</h4>

<p>å½“åŠ¡ä¹‹æ€¥æ˜¯å°† Model å±‚æå–å‡ºæ¥ï¼Œä¸ºäº†è¯´æ˜ç®€å•ï¼Œæš‚æ—¶å…ˆåªè€ƒè™‘çº¯æœ¬åœ°çš„æƒ…å†µï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">ToDoItem</span><span class="p">:</span> <span class="kt">Equatable</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">func</span> <span class="o">==</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">ToDoItem</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">ToDoItem</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">id</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">ToDoStore</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">shared</span> <span class="o">=</span> <span class="kt">ToDoStore</span><span class="p">()</span>
    
    <span class="kd">private(set)</span> <span class="k">var</span> <span class="nv">items</span><span class="p">:</span> <span class="p">[</span><span class="kt">ToDoItem</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="kd">private</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{}</span>
    
    <span class="kd">func</span> <span class="nf">append</span><span class="p">(</span><span class="nv">item</span><span class="p">:</span> <span class="kt">ToDoItem</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">items</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">append</span><span class="p">(</span><span class="nv">newItems</span><span class="p">:</span> <span class="p">[</span><span class="kt">ToDoItem</span><span class="p">])</span> <span class="p">{</span>
        <span class="n">items</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="nv">contentsOf</span><span class="p">:</span> <span class="n">newItems</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">remove</span><span class="p">(</span><span class="nv">item</span><span class="p">:</span> <span class="kt">ToDoItem</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">index</span> <span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="nf">index</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="n">item</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
        <span class="nf">remove</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="n">index</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">remove</span><span class="p">(</span><span class="n">at</span> <span class="nv">index</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">items</span><span class="o">.</span><span class="nf">remove</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="n">index</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">edit</span><span class="p">(</span><span class="nv">original</span><span class="p">:</span> <span class="kt">ToDoItem</span><span class="p">,</span> <span class="nv">new</span><span class="p">:</span> <span class="kt">ToDoItem</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">index</span> <span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="nf">index</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="n">original</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
        <span class="n">items</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">count</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">items</span><span class="o">.</span><span class="n">count</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">item</span><span class="p">(</span><span class="n">at</span> <span class="nv">index</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">ToDoItem</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">items</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å½“ç„¶ï¼Œä¸ºäº†ä¸€æ­¥åˆ°ä½ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æŠŠä¸Šé¢çš„ <code class="highlighter-rouge">NetworkService</code> åŠ ä¸Šï¼Œå†™æˆå¼‚æ­¥ APIï¼Œä¾‹å¦‚ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">getAll</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Promise</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">ToDoItem</span><span class="p">]</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kt">NetworkService</span><span class="o">.</span><span class="nf">getExistingToDoItems</span><span class="p">()</span>
      <span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">items</span> <span class="k">in</span>
          <span class="k">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">items</span>
          <span class="k">return</span> <span class="kt">Promise</span><span class="o">.</span><span class="nf">value</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
      <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">append</span><span class="p">(</span><span class="nv">item</span><span class="p">:</span> <span class="kt">ToDoItem</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Promise</span><span class="o">&lt;</span><span class="kt">Void</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kt">NetworkService</span><span class="o">.</span><span class="nf">appendToDoItem</span><span class="p">(</span><span class="nv">item</span><span class="p">:</span> <span class="n">item</span><span class="p">)</span>
      <span class="o">.</span><span class="n">then</span> <span class="p">{</span>
          <span class="k">self</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
          <span class="k">return</span> <span class="kt">Promise</span><span class="o">.</span><span class="nf">value</span><span class="p">(())</span>
      <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>ä¸ºäº†å¥½çœ‹ï¼Œè¿™é‡Œç”¨äº†ä¸€äº› <a href="https://github.com/mxcl/PromiseKit">PromiseKit çš„ä¸œè¥¿</a>ï¼Œå¦‚æœä½ ä¸ç†Ÿæ‚‰ Promiseï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒï¼Œå¯ä»¥å°†å®ƒä»¬ç®€å•åœ°çœ‹ä½œ closure çš„å½¢å¼å°±å¥½ï¼Œè¿™å¹¶ä¸ä¼šå½±å“ç»§ç»­é˜…è¯»æœ¬æ–‡ï¼š</p>
</blockquote>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">getAll</span><span class="p">(</span><span class="nv">completion</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(([</span><span class="kt">ToDoItem</span><span class="p">]?,</span> <span class="kt">Error</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)?)</span> <span class="p">{</span>
    <span class="kt">NetworkService</span><span class="o">.</span><span class="n">getExistingToDoItems</span> <span class="p">{</span> <span class="n">response</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
            <span class="nf">completion</span><span class="p">?(</span><span class="kc">nil</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">items</span> 
            <span class="nf">completion</span><span class="p">?(</span><span class="n">response</span><span class="o">.</span><span class="n">items</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°† <code class="highlighter-rouge">items</code> ä» <code class="highlighter-rouge">ToDoListViewController</code> æ‹¿å‡ºæ¥ã€‚å¯¹å•ç‹¬æå–çš„ Model è¿›è¡Œæµ‹è¯•å˜å¾—éå¸¸å®¹æ˜“ï¼Œçº¯ Model çš„æ“ä½œä¸ Controller æ— å…³ï¼Œ<code class="highlighter-rouge">ToDoEditViewController</code> ä¹Ÿä¸å†éœ€è¦å°†è¡Œä¸º delegate å› <code class="highlighter-rouge">ToDoListViewController</code>ï¼Œç¼–è¾‘æ¡ç›®çš„ View Controller å¯ä»¥é€šè¿‡æˆä¸ºäº†çœŸæ­£æ„ä¹‰ä¸Šçš„ View Controllerï¼Œè€Œä¸æ­¢æ˜¯ <code class="highlighter-rouge">ToDoListViewController</code> çš„â€œéš¶å± Viewâ€ã€‚</p>

<p>å•ç‹¬çš„ <code class="highlighter-rouge">ToDoStore</code> ä½œä¸ºæ¨¡å‹å¸¦æ¥çš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œå› ä¸ºå®ƒä¸å…·ä½“çš„ View Controller åˆ†ç¦»äº†ï¼Œåœ¨è¿›è¡ŒæŒä¹…åŒ–æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰æ›´å¤šçš„é€‰æ‹©ã€‚ä¸è®ºæ˜¯ä»ç½‘ç»œè·å–ï¼Œè¿˜æ˜¯ä¿å­˜åœ¨æœ¬åœ°çš„æ•°æ®åº“ï¼Œè¿™äº›æ“ä½œéƒ½ä¸å¿… (ä¹Ÿä¸åº”å†™åœ¨ View Controller ä¸­)ã€‚å¦‚æœæœ‰å¤šç§æ•°æ®æ¥æºï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°åˆ›å»ºç±»ä¼¼ <code class="highlighter-rouge">ToDoStoreCoordinator</code> æˆ–è€… <code class="highlighter-rouge">ToDoStoreDataProvider</code> è¿™æ ·çš„ç±»å‹ã€‚æ—¢å¯ä»¥æ»¡è¶³å•ä¸€èŒè´£ï¼Œä¹Ÿæ˜“äºè¦†ç›–å®Œæ•´çš„æµ‹è¯•ã€‚</p>

<h4 id="å•å‘æ•°æ®æµåŠ¨">å•å‘æ•°æ®æµåŠ¨</h4>

<p>æ¥ä¸‹æ¥ï¼Œå°†æ•°æ®æµåŠ¨æŒ‰ç…§ MVC çš„æ ‡å‡†è¿›è¡Œæ¢³ç†å°±æ˜¯è‡ªç„¶è€Œç„¶çš„äº‹æƒ…äº†ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯é¿å… UI è¡Œä¸ºç›´æ¥å½±å“ UIï¼Œè€Œæ˜¯ç”± Model çš„çŠ¶æ€é€šè¿‡ Controller æ¥ç¡®å®š UI çŠ¶æ€ã€‚è¿™éœ€è¦æˆ‘ä»¬çš„ Model èƒ½å¤Ÿä»¥æŸç§â€œéç›´æ¥â€çš„æ–¹å¼å‘ Controller è¿›è¡Œæ±‡æŠ¥ã€‚æŒ‰ç…§ä¸Šé¢çš„ MVC å›¾ï¼Œæˆ‘ä»¬ä½¿ç”¨ Notification æ¥æå®šã€‚</p>

<p>å¯¹ <code class="highlighter-rouge">ToDoStore</code> è¿›è¡Œä¸€äº›æ”¹é€ ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">ToDoStore</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="kt">ChangeBehavior</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nf">add</span><span class="p">([</span><span class="kt">Int</span><span class="p">])</span>
        <span class="k">case</span> <span class="nf">remove</span><span class="p">([</span><span class="kt">Int</span><span class="p">])</span>
        <span class="k">case</span> <span class="n">reload</span>
    <span class="p">}</span>
    
    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">diff</span><span class="p">(</span><span class="nv">original</span><span class="p">:</span> <span class="p">[</span><span class="kt">ToDoItem</span><span class="p">],</span> <span class="nv">now</span><span class="p">:</span> <span class="p">[</span><span class="kt">ToDoItem</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kt">ChangeBehavior</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">originalSet</span> <span class="o">=</span> <span class="kt">Set</span><span class="p">(</span><span class="n">original</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">nowSet</span> <span class="o">=</span> <span class="kt">Set</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">originalSet</span><span class="o">.</span><span class="nf">isSubset</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="n">nowSet</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Appended</span>
            <span class="k">let</span> <span class="nv">added</span> <span class="o">=</span> <span class="n">nowSet</span><span class="o">.</span><span class="nf">subtracting</span><span class="p">(</span><span class="n">originalSet</span><span class="p">)</span>
            <span class="k">let</span> <span class="nv">indexes</span> <span class="o">=</span> <span class="n">added</span><span class="o">.</span><span class="n">compactMap</span> <span class="p">{</span> <span class="n">now</span><span class="o">.</span><span class="nf">index</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">}</span>
            <span class="k">return</span> <span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">indexes</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">nowSet</span><span class="o">.</span><span class="nf">isSubset</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="n">originalSet</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// Removed</span>
            <span class="k">let</span> <span class="nv">removed</span> <span class="o">=</span> <span class="n">originalSet</span><span class="o">.</span><span class="nf">subtracting</span><span class="p">(</span><span class="n">nowSet</span><span class="p">)</span>
            <span class="k">let</span> <span class="nv">indexes</span> <span class="o">=</span> <span class="n">removed</span><span class="o">.</span><span class="n">compactMap</span> <span class="p">{</span> <span class="n">original</span><span class="o">.</span><span class="nf">index</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">}</span>
            <span class="k">return</span> <span class="o">.</span><span class="nf">remove</span><span class="p">(</span><span class="n">indexes</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// Both appended and removed</span>
            <span class="k">return</span> <span class="o">.</span><span class="n">reload</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">items</span><span class="p">:</span> <span class="p">[</span><span class="kt">ToDoItem</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">{</span>
        <span class="k">didSet</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">behavior</span> <span class="o">=</span> <span class="kt">ToDoStore</span><span class="o">.</span><span class="nf">diff</span><span class="p">(</span><span class="nv">original</span><span class="p">:</span> <span class="n">oldValue</span><span class="p">,</span> <span class="nv">now</span><span class="p">:</span> <span class="n">items</span><span class="p">)</span>
            <span class="kt">NotificationCenter</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">post</span><span class="p">(</span>
                <span class="nv">name</span><span class="p">:</span> <span class="o">.</span><span class="n">toDoStoreDidChangedNotification</span><span class="p">,</span>
                <span class="nv">object</span><span class="p">:</span> <span class="k">self</span><span class="p">,</span>
                <span class="nv">typedUserInfo</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="nv">toDoStoreDidChangedChangeBehaviorKey</span><span class="p">:</span> <span class="n">behavior</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>è¿™é‡Œæ·»åŠ äº† <code class="highlighter-rouge">ChangeBehavior</code> ä½œä¸ºâ€œæç¤ºâ€ï¼Œæ¥å…·ä½“å‘Šè¯‰å¤–ç•Œ Model ä¸­å‘ç”Ÿäº†ä»€ä¹ˆã€‚<code class="highlighter-rouge">diff</code> æ–¹æ³•é€šè¿‡æ¯”è¾ƒåŸå§‹ <code class="highlighter-rouge">items</code> å’Œå½“å‰ <code class="highlighter-rouge">items</code> æ¥ç¡®å®šå‘ç”Ÿäº†å“ªç§ <code class="highlighter-rouge">ChangeBehavior</code>ã€‚æœ€åï¼Œä½¿ç”¨ <code class="highlighter-rouge">items</code> çš„ <code class="highlighter-rouge">didSet</code> æ¥å‘é€ Notificationã€‚</p>

<blockquote>
  <p>ç”±äº Swift çš„æ•°ç»„æ˜¯å€¼ç±»å‹ï¼Œå¯¹äº <code class="highlighter-rouge">items</code> çš„å…ƒç´ å¢åŠ ï¼Œåˆ é™¤ï¼Œä¿®æ”¹æˆ–è€…æ•´ä½“å˜é‡æ›¿æ¢ï¼Œéƒ½ä¼šè§¦å‘ <code class="highlighter-rouge">didSet</code> çš„è°ƒç”¨ã€‚Swift çš„å€¼è¯­ä¹‰ç¼–ç¨‹å¸¦æ¥äº†å¾ˆå¤§çš„ä¾¿åˆ©ã€‚</p>
</blockquote>

<p>åœ¨ <code class="highlighter-rouge">ToDoListViewController</code>ï¼Œç°åœ¨åªéœ€è¦è®¢é˜…è¿™ä¸ªé€šçŸ¥ï¼Œç„¶åæ ¹æ®æ¶ˆæ¯å†…å®¹è¿›è¡Œ UI åé¦ˆå³å¯ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">ToDoListViewController</span><span class="p">:</span> <span class="kt">UITableViewController</span> <span class="p">{</span>
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        <span class="c1">//...</span>
        <span class="kt">NotificationCenter</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">addObserver</span><span class="p">(</span>
            <span class="k">self</span><span class="p">,</span> 
            <span class="nv">selector</span><span class="p">:</span> <span class="kd">#selector(</span><span class="nf">todoItemsDidChange</span><span class="kd">)</span><span class="p">,</span>
            <span class="nv">name</span><span class="p">:</span> <span class="o">.</span><span class="n">toDoStoreDidChangedNotification</span><span class="p">,</span> 
            <span class="nv">object</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">syncTableView</span><span class="p">(</span><span class="k">for</span> <span class="nv">behavior</span><span class="p">:</span> <span class="kt">ToDoStore</span><span class="o">.</span><span class="kt">ChangeBehavior</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="n">behavior</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="k">let</span> <span class="nv">indexes</span><span class="p">):</span>
            <span class="k">let</span> <span class="nv">indexPathes</span> <span class="o">=</span> <span class="n">indexes</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="kt">IndexPath</span><span class="p">(</span><span class="nv">row</span><span class="p">:</span> <span class="nv">$0</span><span class="p">,</span> <span class="nv">section</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
            <span class="n">tableView</span><span class="o">.</span><span class="nf">insertRows</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="n">indexPathes</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="o">.</span><span class="n">automatic</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">remove</span><span class="p">(</span><span class="k">let</span> <span class="nv">indexes</span><span class="p">):</span>
            <span class="k">let</span> <span class="nv">indexPathes</span> <span class="o">=</span> <span class="n">indexes</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="kt">IndexPath</span><span class="p">(</span><span class="nv">row</span><span class="p">:</span> <span class="nv">$0</span><span class="p">,</span> <span class="nv">section</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
            <span class="n">tableView</span><span class="o">.</span><span class="nf">deleteRows</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="n">indexPathes</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="o">.</span><span class="n">automatic</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">reload</span><span class="p">:</span>
            <span class="n">tableView</span><span class="o">.</span><span class="nf">reloadData</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">updateAddButtonState</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">addButton</span><span class="p">?</span><span class="o">.</span><span class="n">isEnabled</span> <span class="o">=</span> <span class="kt">ToDoStore</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">count</span> <span class="o">&lt;</span> <span class="mi">10</span>
    <span class="p">}</span>

    <span class="kd">@objc</span> <span class="kd">func</span> <span class="nf">todoItemsDidChange</span><span class="p">(</span><span class="n">_</span> <span class="nv">notification</span><span class="p">:</span> <span class="kt">Notification</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">behavior</span> <span class="o">=</span> <span class="n">notification</span><span class="o">.</span><span class="nf">getUserInfo</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="n">toDoStoreDidChangedChangeBehaviorKey</span><span class="p">)</span>
        <span class="nf">syncTableView</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">behavior</span><span class="p">)</span>
        <span class="nf">updateAddButtonState</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>Notification æœ¬èº«æœ‰å¾ˆé•¿çš„å†å²ï¼Œæ˜¯ä¸€å¥—åŸºäºå­—ç¬¦ä¸²çš„æ¾æ•£ APIã€‚è¿™é‡Œé€šè¿‡æ‰©å±•å’Œæ³›å‹çš„æ–¹å¼ï¼Œç”± <code class="highlighter-rouge">.toDoStoreDidChangedNotification</code>ï¼Œ<code class="highlighter-rouge">.toDoStoreDidChangedChangeBehaviorKey</code> å’Œ <code class="highlighter-rouge">post(name:object:typedUserInfo)</code> ä»¥åŠ <code class="highlighter-rouge">getUserInfo(for:)</code> æ„æˆäº†ä¸€å¥—æ›´ Swifty çš„ç±»å‹å®‰å…¨çš„ <code class="highlighter-rouge">NotificationCenter</code> å’Œ <code class="highlighter-rouge">userInfo</code> çš„ä½¿ç”¨æ–¹å¼ã€‚å¦‚æœä½ æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥å‚çœ‹<a href="https://gist.github.com/onevcat/9e08111cebb1967cb96a737ed40f9f14">æœ€åçš„ä»£ç </a>ã€‚</p>
</blockquote>

<p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¹‹å‰ç”¨æ¥ç»´æŠ¤ table view cell å’Œ <code class="highlighter-rouge">addButton</code> çŠ¶æ€çš„ä»£ç éƒ½åˆ é™¤äº†ã€‚ç”¨æˆ·æ“ä½œ UI å”¯ä¸€çš„ä½œç”¨å°±æ˜¯è§¦å‘æ¨¡å‹çš„æ›´æ–°ï¼Œç„¶åæ¨¡å‹æ›´æ–°é€šè¿‡é€šçŸ¥æ¥åˆ·æ–° UIï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">ToDoListViewController</span><span class="p">:</span> <span class="kt">UITableViewController</span> <span class="p">{</span>
    <span class="c1">// ä¿å­˜å½“å‰å¾…åŠäº‹é¡¹</span>
    <span class="c1">// var items: [ToDoItem] = []</span>
    
    <span class="c1">// ç‚¹å‡»æ·»åŠ æŒ‰é’®</span>
    <span class="kd">@objc</span> <span class="kd">func</span> <span class="nf">addButtonPressed</span><span class="p">(</span><span class="n">_</span> <span class="nv">sender</span><span class="p">:</span> <span class="kt">Any</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// let newCount = items.count + 1</span>
        <span class="c1">// let title = "ToDo Item \(newCount)"</span>
        
        <span class="c1">// æ›´æ–° `items`</span>
        <span class="c1">// items.append(.init(title: title))</span>
        
        <span class="c1">// ä¸º table view æ·»åŠ æ–°è¡Œ</span>
        <span class="c1">// let indexPath = IndexPath(row: newCount - 1, section: 0)</span>
        <span class="c1">// tableView.insertRows(at: [indexPath], with: .automatic)</span>
        
        <span class="c1">// ç¡®å®šæ˜¯å¦è¾¾åˆ°åˆ—è¡¨ä¸Šé™ï¼Œå¦‚æœè¾¾åˆ°ï¼Œç¦ç”¨ addButton</span>
        <span class="c1">// if newCount &gt;= 10 {</span>
        <span class="c1">//    addButton?.isEnabled = false</span>
        <span class="c1">// }</span>
        <span class="k">let</span> <span class="nv">store</span> <span class="o">=</span> <span class="kt">ToDoStore</span><span class="o">.</span><span class="n">shared</span>
        <span class="k">let</span> <span class="nv">newCount</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">let</span> <span class="nv">title</span> <span class="o">=</span> <span class="s">"ToDo Item </span><span class="se">\(</span><span class="n">newCount</span><span class="se">)</span><span class="s">"</span>
        
        <span class="n">store</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="nv">item</span><span class="p">:</span> <span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="n">title</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">ToDoListViewController</span> <span class="p">{</span>
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">trailingSwipeActionsConfigurationForRowAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UISwipeActionsConfiguration</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">deleteAction</span> <span class="o">=</span> <span class="kt">UIContextualAction</span><span class="p">(</span><span class="nv">style</span><span class="p">:</span> <span class="o">.</span><span class="n">destructive</span><span class="p">,</span> <span class="nv">title</span><span class="p">:</span> <span class="s">"Delete"</span><span class="p">)</span> <span class="p">{</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">done</span> <span class="k">in</span>
            <span class="c1">// ç”¨æˆ·ç¡®è®¤åˆ é™¤ï¼Œä» `items` ä¸­ç§»é™¤è¯¥äº‹é¡¹</span>
            <span class="c1">// self.items.remove(at: indexPath.row)</span>
            <span class="c1">// ä» table view ä¸­ç§»é™¤å¯¹åº”è¡Œ</span>
            <span class="c1">// self.tableView.deleteRows(at: [indexPath], with: .automatic)</span>
            <span class="c1">// ç»´æŠ¤ addButton çŠ¶æ€</span>
            <span class="c1">// if self.items.count &lt; 10 {</span>
            <span class="c1">//     self.addButton?.isEnabled = true</span>
            <span class="c1">// }</span>
            <span class="kt">ToDoStore</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">remove</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="n">indexPath</span><span class="o">.</span><span class="n">row</span><span class="p">)</span>
            <span class="nf">done</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kt">UISwipeActionsConfiguration</span><span class="p">(</span><span class="nv">actions</span><span class="p">:</span> <span class="p">[</span><span class="n">deleteAction</span><span class="p">])</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ç°åœ¨ï¼Œä¸å¦¨å†è€ƒè™‘ä¸€ä¸‹ä¸Šä¸€èŠ‚ä¸­åœºæ™¯ä¸€ (ç¼–è¾‘æ¡ç›®) å’Œåœºæ™¯äºŒ (ç½‘ç»œåŒæ­¥) çš„éœ€æ±‚ï¼Œæ˜¯ä¸æ˜¯è§‰å¾—ç»“æ„ä¼šæ¸…æ™°å¾ˆå¤šå‘¢ï¼Ÿ</p>

<ol>
  <li>æˆ‘ä»¬ç°åœ¨æœ‰äº†ä¸€ä¸ªå•ç‹¬çš„å¯ä»¥æµ‹è¯•çš„ Model å±‚ï¼Œé€šè¿‡ç®€å•çš„ Mockï¼Œ<code class="highlighter-rouge">ToDoListViewController</code> ä¹Ÿå¯ä»¥è¢«æ–¹ä¾¿åœ°æµ‹è¯•ã€‚</li>
  <li>UI æ“ä½œ -&gt; ç»ç”± Controller è¿›è¡Œæ¨¡å‹å˜æ›´ -&gt; ç»ç”± Controller å°†å½“å‰æ¨¡å‹â€œæ˜ å°„â€ä¸º UI çŠ¶æ€ï¼Œè¿™ä¸ªæ•°æ®æµåŠ¨æ–¹å‘æ˜¯ä¸¥æ ¼å¯é¢„æµ‹çš„ (å¹¶ä¸”åº”å½“æ—¶åˆ»ç‰¢è®°éœ€è¦ä¿æŒè¿™ä¸ªå¾ªç¯)ã€‚è¿™å¤§å¤§å‡å°‘äº† Controller å±‚çš„è´Ÿæ‹…ã€‚</li>
  <li>ç”±äºæ¨¡å‹å±‚ä¸å†è¢«å•ä¸€ View Controller æŒæœ‰ï¼Œå…¶ä»–çš„ Controller (ä¸å•æŒ‡åƒæ˜¯ç¼–è¾‘ç”¨çš„ Edit View Controller è¿™æ ·çš„è§†å›¾æ§åˆ¶å™¨ï¼Œä¹ŸåŒ…æ‹¬æ¯”å¦‚è´Ÿè´£ä¸‹è½½çš„ Controller ç­‰ç­‰è¿™ç±»æ•°æ®æ§åˆ¶å™¨) ä¹Ÿå¯ä»¥æ“ä½œæ¨¡å‹å±‚ã€‚åœ¨æ­¤åŒæ—¶ï¼Œæ‰€æœ‰çš„æ¨¡å‹ç»“æœä¼šè¢«è‡ªåŠ¨ä¸”æ­£ç¡®åœ°ååº”åˆ° View ä¸Šï¼Œè¿™ä¸ºå¤š Controller ååŒå·¥ä½œå’Œæ›´å¤æ‚çš„åœºæ™¯æä¾›äº†åšå®çš„åŸºç¡€ã€‚</li>
</ol>

<p>è¿™ä¸ªä¾‹å­çš„ä¿®æ”¹åçš„æœ€ç»ˆç‰ˆæœ¬<a href="https://gist.github.com/onevcat/9e08111cebb1967cb96a737ed40f9f14">å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°</a>ã€‚</p>

<h4 id="å…¶ä»–é€‰é¡¹">å…¶ä»–é€‰é¡¹</h4>

<p>MVC æœ¬èº«çš„æ¦‚å¿µç›¸å½“ç®€å•ï¼ŒåŒæ—¶å®ƒä¹Ÿç»™äº†å¼€å‘è€…å¾ˆå¤§çš„è‡ªç”±åº¦ã€‚Massive View Controller å¾€å¾€å°±æ˜¯åˆ©ç”¨äº†è¿™ä¸ªè‡ªç”±åº¦ï¼Œâ€œéšæ„â€åœ°å°†é€»è¾‘æ”¾åœ¨ controller å±‚æ‰€é€ æˆçš„åæœã€‚</p>

<p>æœ‰ä¸€äº›å…¶ä»–æ¶æ„é€‰æ‹©ï¼Œæœ€å¸¸ç”¨çš„æ¯”å¦‚ MVVM å’Œå“åº”å¼ç¼–ç¨‹ (æ¯”å¦‚ RxSwift)ã€‚MVVM å¯ä»¥è¯´å‡ ä¹å°±æ˜¯ä¸€ä¸ª MVCï¼Œä¸è¿‡é€šè¿‡ View Model å±‚æ¥å°†æ•°æ®å’Œè§†å›¾è¿›è¡Œç»‘å®šã€‚å¦‚æœä½ å†™è¿‡ Reactive æ¶æ„çš„è¯ï¼Œå¯èƒ½ä¼šå‘ç°æˆ‘ä»¬åœ¨æœ¬æ–‡ä¸­ MVC çš„ Controller å±‚çš„é€šçŸ¥æ¥æ”¶å’Œ Rx çš„äº‹ä»¶æµéå¸¸ç›¸ä¼¼ã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œå“åº”å¼ç¼–ç¨‹â€œå€Ÿç”¨â€äº† MVVM çš„æ€è·¯ï¼Œæä¾›äº†ä¸€å¥— API å°†äº‹ä»¶æµä¸ UI çŠ¶æ€è¿›è¡Œç»‘å®š (RxCocoa)ã€‚</p>

<p>è¿™äº›â€œè¶…è¶Šâ€ MVC çš„æ¶æ„æ–¹å¼æ— ä¸€ä¾‹å¤–åœ°åŠ å…¥äº†é¢å¤–çš„è§„åˆ™å’Œé™åˆ¶ï¼Œæä¾›äº†ç›¸å¯¹ MVC æ¥è¯´æ›´å°çš„è‡ªç”±åº¦ã€‚è¿™å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§„èŒƒå¼€å‘è€…çš„è¡Œä¸ºï¼Œæä¾›æ›´åŠ ç»Ÿä¸€çš„ä»£ç  (å½“ç„¶ä»£ä»·æ˜¯é¢å¤–çš„å­¦ä¹ æˆæœ¬)ã€‚å®Œå…¨ç†è§£å’Œä¸¥æ ¼éµå®ˆ MVC çš„æ€æƒ³ï¼Œæˆ‘ä»¬å…¶å®ä¹Ÿå¯ä»¥å°† MVC ç”¨å¾—â€œå°è€Œç¾â€ã€‚ç¬¬ä¸€æ­¥ï¼Œå°±ä»é¿å…æ–‡ä¸­è¿™ç±»å¸¸è§â€œé”™è¯¯â€å¼€å§‹å§~</p>

<blockquote>
  <p>èƒ½å¤Ÿä½¿ç”¨ç®€å•çš„æ¶æ„æ¥æ­å»ºå¤æ‚çš„å·¥ç¨‹ï¼Œåˆ¶ä½œå‡ºè®©å…¶ä»–å¼€å‘è€…å¯ä»¥è½»æ¾ç†è§£çš„è½¯ä»¶ï¼Œé¿å…é«˜é¢çš„åç»­ç»´æŠ¤æˆæœ¬ï¼Œè®©è½¯ä»¶å¯æŒç»­å‘å±•å¹¶é•¿æœŸæ´»è·ƒï¼Œåº”è¯¥æ˜¯æ¯ä¸ªå¼€å‘è€…åœ¨æ„å»ºè½¯ä»¶æ˜¯å¿…é¡»è€ƒè™‘çš„äº‹æƒ…ã€‚</p>
</blockquote>

:ET